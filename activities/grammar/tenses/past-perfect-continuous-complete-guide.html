<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Past Perfect Continuous - Complete Guide & Practice | ESOL Teacher Resources</title>
  <meta name="description" content="Complete step-by-step guide to Past Perfect Continuous tense emphasizing duration and ongoing actions before a point in the past with For/Since and comparison with Past Perfect Simple for intermediate learners.">
  <meta name="activity-type" content="guide">
  <meta name="activity-level" content="intermediate">
  <meta name="activity-category" content="grammar">
  <link rel="stylesheet" href="../../../assets/css/main.css">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    .grammar-guide {
      max-width: 900px;
      margin: 0 auto;
    }
    
    .step-section {
      background: white;
      border: 2px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--spacing-xl);
      margin: var(--spacing-2xl) 0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    .step-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
      border-radius: 50%;
      font-weight: 700;
      font-size: var(--font-size-lg);
      margin-right: var(--spacing-md);
    }
    
    .step-header {
      display: flex;
      align-items: center;
      margin-bottom: var(--spacing-lg);
      padding-bottom: var(--spacing-md);
      border-bottom: 2px solid #6366f1;
    }
    
    .step-title {
      color: #1e293b;
      font-size: var(--font-size-xl);
      margin: 0;
    }
    
    .explanation-box {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);
      border: 1px solid rgba(99, 102, 241, 0.2);
      padding: var(--spacing-lg);
      margin: var(--spacing-lg) 0;
      border-radius: var(--radius-md);
    }
    
    .formula-box {
      background: white;
      border: 2px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      margin: var(--spacing-lg) 0;
      text-align: center;
    }
    
    .formula-part {
      display: inline-block;
      padding: var(--spacing-xs) var(--spacing-sm);
      margin: 2px;
      border-radius: var(--radius-sm);
      font-weight: 600;
      border: 1px solid var(--color-border);
    }
    
    .subject-part {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(99, 102, 241, 0.05) 100%);
      color: #6366f1;
    }
    
    .verb-part {
      background: linear-gradient(135deg, rgba(236, 72, 153, 0.1) 0%, rgba(236, 72, 153, 0.05) 100%);
      color: #ec4899;
    }
    
    .object-part {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%);
      color: #10b981;
    }
    
    .example-box {
      background: var(--color-bg-light);
      padding: var(--spacing-md);
      margin: var(--spacing-md) 0;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(99, 102, 241, 0.2);
    }
    
    .example-box .example {
      margin: var(--spacing-xs) 0;
      padding: var(--spacing-xs);
    }
    
    .exercise-section {
      background: var(--color-bg-light);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      margin: var(--spacing-lg) 0;
    }
    
    .exercise-title {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      color: #6366f1;
      margin-bottom: var(--spacing-md);
      font-size: var(--font-size-lg);
    }
    
    .exercise-instructions {
      color: var(--color-text-muted);
      margin-bottom: var(--spacing-md);
      font-style: italic;
    }
    
    .exercise-item {
      margin: var(--spacing-md) 0;
      padding: var(--spacing-md);
      background: white;
      border-radius: var(--radius-sm);
      border: 1px solid var(--color-border);
    }
    
    .exercise-item label {
      display: block;
      margin-bottom: var(--spacing-xs);
      font-weight: 500;
    }
    
    .exercise-item input[type="text"],
    .exercise-item select {
      width: 100%;
      padding: var(--spacing-sm);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      font-size: var(--font-size-base);
      font-family: inherit;
    }
    
    .exercise-item input[type="text"]:focus,
    .exercise-item select:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }
    
    .exercise-item input[type="text"].question-input {
      width: auto;
      min-width: 80px;
      max-width: 150px;
      display: inline-block;
    }
    
    .exercise-item input[type="radio"] {
      margin-right: var(--spacing-sm);
      cursor: pointer;
      width: 18px;
      height: 18px;
      accent-color: #6366f1;
    }
    
    .exercise-item label {
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: var(--spacing-xs);
      border-radius: var(--radius-sm);
      transition: background-color 0.2s;
    }
    
    .exercise-item label:hover {
      background-color: rgba(99, 102, 241, 0.05);
    }
    
    .exercise-item label:has(input[type="radio"]:checked) {
      background-color: rgba(99, 102, 241, 0.1);
    }
    
    @supports not selector(:has(*)) {
      .exercise-item input[type="radio"]:checked + span {
        background-color: rgba(99, 102, 241, 0.1);
      }
    }
    
    .check-button {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
      border: none;
      padding: var(--spacing-sm) var(--spacing-lg);
      border-radius: var(--radius-md);
      font-weight: 600;
      cursor: pointer;
      margin-top: var(--spacing-md);
      transition: transform 0.2s, box-shadow 0.2s;
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }
    
    .check-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }
    
    .feedback {
      margin-top: var(--spacing-md);
      padding: var(--spacing-md);
      border-radius: var(--radius-sm);
      display: none;
    }
    
    .feedback.correct {
      background: rgba(16, 185, 129, 0.1);
      border-left: 3px solid #10b981;
      color: #10b981;
    }
    
    .feedback.incorrect {
      background: rgba(239, 68, 68, 0.1);
      border-left: 3px solid #ef4444;
      color: #ef4444;
    }
    
    .usage-list {
      list-style: none;
      padding: 0;
    }
    
    .usage-list li {
      padding: var(--spacing-sm);
      margin: var(--spacing-xs) 0;
      background: var(--color-bg-light);
      border-radius: var(--radius-sm);
      border: 1px solid rgba(99, 102, 241, 0.2);
    }
    
    .usage-list li strong {
      color: #6366f1;
    }
    
    .highlight {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.15) 100%);
      padding: 2px 6px;
      border-radius: 3px;
      font-weight: 600;
    }
    
    .tip-box {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%);
      padding: var(--spacing-md);
      margin: var(--spacing-md) 0;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(245, 158, 11, 0.3);
    }
    
    .tip-box strong {
      color: #f59e0b;
    }
    
    .word-scramble-section {
      background: var(--color-bg-light);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      margin: var(--spacing-lg) 0;
    }
    
    .word-cards {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-xs);
      margin: var(--spacing-md) 0;
      padding: var(--spacing-md);
      background: white;
      border-radius: var(--radius-sm);
      border: 1px dashed var(--color-border);
    }
    
    .word-card {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
      border: 2px solid #6366f1;
      border-radius: var(--radius-sm);
      padding: var(--spacing-xs) var(--spacing-sm);
      font-size: var(--font-size-base);
      font-weight: 600;
      color: #6366f1;
      display: inline-block;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .word-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
    }
    
    .word-card.selected {
      background: #6366f1;
      color: white;
      border-color: #4f46e5;
    }
    
    .scramble-input {
      width: 100%;
      padding: var(--spacing-md);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-sm);
      font-size: var(--font-size-base);
      font-family: inherit;
      margin-top: var(--spacing-sm);
      min-height: 50px;
    }
    
    .scramble-input:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }
    
    .scramble-hint {
      font-size: var(--font-size-sm);
      color: var(--color-text-muted);
      font-style: italic;
      margin-top: var(--spacing-xs);
    }
    
    .progress-indicator {
      background: var(--color-bg-light);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      margin-bottom: var(--spacing-xl);
      text-align: center;
    }
    
    .progress-bar {
      display: flex;
      gap: var(--spacing-xs);
      justify-content: center;
      margin-top: var(--spacing-sm);
    }
    
    .progress-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--color-border);
      transition: all 0.3s;
    }
    
    .progress-dot.active {
      background: #6366f1;
      transform: scale(1.2);
    }
    
    .progress-dot.completed {
      background: #10b981;
    }
    
    /* Dark Mode Styles */
    [data-theme="dark"] .step-section {
      background: var(--color-bg-light);
      border-color: var(--color-border);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    [data-theme="dark"] .formula-box {
      background: var(--color-bg-light);
      border-color: var(--color-border);
    }
    
    [data-theme="dark"] .formula-part {
      border-color: var(--color-border);
    }
    
    [data-theme="dark"] .subject-part {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(99, 102, 241, 0.1) 100%);
      color: #818cf8;
    }
    
    [data-theme="dark"] .verb-part {
      background: linear-gradient(135deg, rgba(236, 72, 153, 0.2) 0%, rgba(236, 72, 153, 0.1) 100%);
      color: #f472b6;
    }
    
    [data-theme="dark"] .object-part {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(16, 185, 129, 0.1) 100%);
      color: #34d399;
    }
    
    [data-theme="dark"] .example-box {
      background: var(--color-bg);
      border-color: rgba(129, 140, 248, 0.3);
    }
    
    [data-theme="dark"] .exercise-section {
      background: var(--color-bg-light);
      border-color: var(--color-border);
    }
    
    [data-theme="dark"] .exercise-item {
      background: var(--color-bg);
      border-color: var(--color-border);
      color: var(--color-text);
    }
    
    [data-theme="dark"] .exercise-item label {
      color: var(--color-text);
    }
    
    [data-theme="dark"] .exercise-item input[type="text"],
    [data-theme="dark"] .exercise-item select {
      background: var(--color-bg-light);
      border-color: var(--color-border);
      color: var(--color-text);
    }
    
    [data-theme="dark"] .exercise-item input[type="text"]:focus,
    [data-theme="dark"] .exercise-item select:focus {
      border-color: #818cf8;
      box-shadow: 0 0 0 3px rgba(129, 140, 248, 0.2);
    }
    
    [data-theme="dark"] .explanation-box {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
      border-color: rgba(129, 140, 248, 0.3);
    }
    
    [data-theme="dark"] .explanation-box h3 {
      color: #818cf8;
    }
    
    [data-theme="dark"] .step-title {
      color: #818cf8;
    }
    
    [data-theme="dark"] .step-header {
      border-bottom-color: #818cf8;
    }
    
    [data-theme="dark"] .exercise-title {
      color: #818cf8;
    }
    
    [data-theme="dark"] .usage-list li {
      background: var(--color-bg);
      border-color: rgba(129, 140, 248, 0.3);
    }
    
    [data-theme="dark"] .usage-list li strong {
      color: #818cf8;
    }
    
    [data-theme="dark"] .highlight {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.25) 0%, rgba(139, 92, 246, 0.25) 100%);
      color: #c7d2fe;
    }
    
    [data-theme="dark"] .tip-box {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(245, 158, 11, 0.1) 100%);
      border-color: rgba(251, 191, 36, 0.4);
    }
    
    [data-theme="dark"] .tip-box strong {
      color: #fbbf24;
    }
    
    [data-theme="dark"] .progress-indicator {
      background: var(--color-bg-light);
    }
    
    [data-theme="dark"] .progress-dot {
      background: var(--color-border);
    }
    
    [data-theme="dark"] .progress-dot.active {
      background: #818cf8;
    }
    
    [data-theme="dark"] .progress-dot.completed {
      background: #34d399;
    }
    
    [data-theme="dark"] .word-scramble-section {
      background: var(--color-bg-light);
      border-color: var(--color-border);
    }
    
    [data-theme="dark"] .word-cards {
      background: var(--color-bg);
      border-color: var(--color-border);
    }
    
    [data-theme="dark"] .word-card {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
      border-color: #818cf8;
      color: #c7d2fe;
    }
    
    [data-theme="dark"] .word-card:hover {
      box-shadow: 0 2px 8px rgba(129, 140, 248, 0.4);
    }
    
    [data-theme="dark"] .word-card.selected {
      background: #818cf8;
      color: white;
      border-color: #6366f1;
    }
    
    [data-theme="dark"] .scramble-input {
      background: var(--color-bg-light);
      border-color: var(--color-border);
      color: var(--color-text);
    }
    
    [data-theme="dark"] .scramble-input:focus {
      border-color: #818cf8;
      box-shadow: 0 0 0 3px rgba(129, 140, 248, 0.2);
    }
    
    [data-theme="dark"] .scramble-hint {
      color: var(--color-text-muted);
    }
    
    .print-button {
      background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
      color: white;
      border: none;
      padding: var(--spacing-sm) var(--spacing-lg);
      border-radius: var(--radius-md);
      font-weight: 600;
      cursor: pointer;
      margin: var(--spacing-md) 0;
      transition: transform 0.2s, box-shadow 0.2s;
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-xs);
      font-size: var(--font-size-base);
    }
    
    .print-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
    }
    
    .print-header {
      display: none;
    }
    
    @media print {
      @page {
        margin: 0.4in 0.5in;
      }
      
      * {
        box-sizing: border-box;
      }
      
      body {
        background: white;
        color: black;
        font-size: 10pt;
        line-height: 1.3;
      }
      
      .site-header,
      .breadcrumbs,
      .check-button,
      .progress-indicator,
      .theme-toggle,
      .mobile-menu-toggle,
      .nav,
      footer,
      .print-button,
      i[data-lucide] {
        display: none !important;
      }
      
      .print-header {
        display: block;
        margin-bottom: 8px;
        padding-bottom: 6px;
        border-bottom: 1px solid #000;
      }
      
      .print-header .name-line {
        font-size: 11pt;
        margin-bottom: 4px;
      }
      
      .print-header .blank-line {
        border-bottom: 1px solid #000;
        display: inline-block;
        min-width: 250px;
        margin-left: 4px;
        height: 14px;
      }
      
      .print-header .date-line {
        font-size: 10pt;
        margin-top: 4px;
      }
      
      .activity-header {
        margin-bottom: 8px;
      }
      
      .activity-title {
        font-size: 16pt;
        color: #000;
        margin-bottom: 4px;
      }
      
      .activity-meta {
        display: none;
      }
      
      .step-section {
        border: 1px solid #ccc;
        margin: 8px 0;
        padding: 8px;
        background: white;
        box-shadow: none;
        page-break-inside: auto;
      }
      
      .step-header {
        border-bottom: 1px solid #000;
        margin-bottom: 6px;
        padding-bottom: 4px;
      }
      
      .step-title {
        color: #000;
        font-size: 12pt;
        margin: 0;
      }
      
      .step-number {
        background: #000;
        color: white;
        width: 24px;
        height: 24px;
        font-size: 10pt;
        margin-right: 6px;
      }
      
      .explanation-box {
        background: #f9f9f9;
        border: 1px solid #ddd;
        padding: 6px;
        margin: 6px 0;
      }
      
      .explanation-box h3,
      .explanation-box h4 {
        font-size: 11pt;
        margin: 4px 0;
      }
      
      .explanation-box p {
        margin: 3px 0;
        font-size: 9pt;
      }
      
      .exercise-section {
        background: white;
        border: 1px solid #ddd;
        padding: 6px;
        margin: 6px 0;
        page-break-inside: auto;
      }
      
      .exercise-title {
        font-size: 10pt;
        margin-bottom: 4px;
      }
      
      .exercise-instructions {
        font-size: 8pt;
        margin-bottom: 4px;
      }
      
      .exercise-item {
        margin: 3px 0;
        padding: 2px;
        background: white;
        border: none;
        font-size: 9pt;
      }
      
      .exercise-item label {
        margin-bottom: 2px;
        font-size: 9pt;
      }
      
      .exercise-item input[type="text"],
      .exercise-item select,
      .scramble-input {
        border: none;
        border-bottom: 1px solid #000;
        background: transparent;
        padding: 2px 0;
        width: 100%;
        font-size: 9pt;
        min-height: auto;
      }
      
      .exercise-item input[type="radio"] {
        margin-right: 4px;
        width: 12px;
        height: 12px;
      }
      
      .exercise-item label {
        padding: 1px 0;
        margin: 1px 0;
        font-size: 9pt;
      }
      
      .word-scramble-section {
        margin: 6px 0;
        padding: 6px;
      }
      
      .word-cards {
        border: 1px dashed #ccc;
        padding: 4px;
        margin: 4px 0;
        background: #f9f9f9;
      }
      
      .word-card {
        background: white;
        border: 1px solid #ccc;
        padding: 2px 4px;
        margin: 1px;
        font-size: 8pt;
      }
      
      .scramble-input {
        border-bottom: 1px solid #000;
        min-height: 20px;
        margin-top: 4px;
        font-size: 9pt;
      }
      
      .scramble-hint {
        font-size: 7pt;
        margin-top: 2px;
      }
      
      .feedback {
        display: none !important;
      }
      
      .tip-box {
        background: #fff9e6;
        border: 1px solid #ddd;
        padding: 4px;
        margin: 4px 0;
        font-size: 8pt;
      }
      
      .formula-box {
        border: 1px solid #ddd;
        padding: 6px;
        margin: 6px 0;
        font-size: 9pt;
      }
      
      .formula-part {
        font-size: 9pt;
        padding: 2px 4px;
      }
      
      .example-box {
        background: #f9f9f9;
        border: 1px solid #ddd;
        padding: 4px;
        margin: 4px 0;
        font-size: 9pt;
      }
      
      .example-box .example {
        margin: 2px 0;
        padding: 1px;
        font-size: 9pt;
      }
      
      .usage-list {
        margin: 4px 0;
      }
      
      .usage-list li {
        background: #f9f9f9;
        border: 1px solid #ddd;
        padding: 4px;
        margin: 3px 0;
        font-size: 9pt;
      }
      
      .usage-list li strong {
        font-size: 9pt;
      }
      
      .highlight {
        background: #e0e0e0;
        padding: 1px 3px;
        font-size: 9pt;
      }
      
      h1, h2, h3, h4 {
        margin: 4px 0;
        page-break-after: avoid;
      }
      
      p {
        margin: 3px 0;
      }
      
      ul, ol {
        margin: 4px 0;
        padding-left: 20px;
      }
      
      li {
        margin: 2px 0;
      }
      
      a {
        color: #000;
        text-decoration: none;
      }
      
      .container {
        max-width: 100%;
        padding: 0;
      }
      
      .grammar-guide {
        max-width: 100%;
      }
      
      /* Remove unnecessary spacing */
      .section {
        padding: 0;
        margin: 0;
      }
      
      /* Compact lists in meaning section */
      .usage-list li .example-box {
        margin-left: 8px;
        margin-top: 2px;
        margin-bottom: 2px;
      }
      
      .usage-list li p {
        font-size: 8pt;
        margin: 1px 0;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <div class="header-content">
        <a href="../../../index.html" class="site-logo">ESOL Teacher Resources</a>
        <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
          <button class="theme-toggle" aria-label="Toggle dark mode" type="button">
            <i data-lucide="moon" class="icon"></i>
          </button>
          <button class="mobile-menu-toggle" aria-label="Toggle menu" aria-expanded="false" type="button">
            <i data-lucide="menu" class="icon"></i>
          </button>
        </div>
        <nav class="nav">
          <ul class="nav-list">
            <li class="nav-item">
              <a href="../index.html" class="nav-link">GRAMMAR</a>
            </li>
            <li class="nav-item">
              <a href="../../writing-reading/index.html" class="nav-link">WRITING/READING</a>
            </li>
            <li class="nav-item">
              <a href="../../speaking/index.html" class="nav-link">SPEAKING</a>
            </li>
            <li class="nav-item">
              <a href="../../vocab/index.html" class="nav-link">VOCAB</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </header>

  <main>
    <section class="section">
      <div class="container">
        <div class="breadcrumbs">
          <a href="../../../index.html">Home</a>
          <span class="breadcrumbs-separator">/</span>
          <a href="../index.html">Grammar</a>
          <span class="breadcrumbs-separator">/</span>
          <a href="../index.html#verb-tenses">Verb Tenses</a>
          <span class="breadcrumbs-separator">/</span>
          <span>Past Perfect Continuous</span>
        </div>

        <div class="activity-header">
          <h1 class="activity-title">Past Perfect Continuous - Complete Step-by-Step Guide</h1>
          <div class="activity-meta">
            <span class="activity-badge badge-guide">Complete Guide</span>
            <span class="activity-level">Intermediate</span>
          </div>
          <button class="print-button" onclick="window.print()">
            <i data-lucide="printer" style="width: 18px; height: 18px;"></i>
            Print Worksheet
          </button>
        </div>

        <!-- Print Header (only visible when printing) -->
        <div class="print-header">
          <div class="name-line">
            <strong>Name:</strong> <span class="blank-line"></span>
          </div>
          <div class="date-line">
            <strong>Date:</strong> <span class="blank-line"></span>
          </div>
        </div>

        <div class="grammar-guide">
          
          <!-- Introduction -->
          <div class="explanation-box">
            <h2 style="color: #1e293b; margin-top: 0;">
              <i data-lucide="book-open" style="width: 20px; height: 20px; display: inline-block; vertical-align: middle;"></i>
              Welcome! Let's Learn Past Perfect Continuous Together
            </h2>
            <p>We're going to learn Past Perfect Continuous step by step. Don't worry - we'll practice each part before moving to the next. Take your time and work through each section!</p>
            <p><strong>What is Past Perfect Continuous?</strong> It's used to talk about actions that started before a point in the past and continued up to that point, emphasizing the <strong>duration</strong> and <strong>ongoing nature</strong> of the action. The key difference from Past Perfect Simple is that we focus on the <strong>process</strong> and <strong>how long</strong> something had been happening before another past event, not just the result.</p>
          </div>

          <!-- MEANING & USAGE SECTION -->
          <div class="step-section" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%); border-color: #6366f1;">
            <div class="step-header">
              <span class="step-number" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">‚òÖ</span>
              <h2 class="step-title">When Do We Use Past Perfect Continuous? Understanding the Meaning</h2>
            </div>

            <div class="explanation-box" style="background: white;">
              <h3 style="color: #1e293b; margin-top: 0;">Why is meaning important?</h3>
              <p>Knowing the <strong>structure</strong> (how to form sentences) is important, but understanding the <strong>meaning</strong> (when and why to use Past Perfect Continuous) helps you use it correctly in real life!</p>
              
              <div style="margin: var(--spacing-lg) 0;">
                <h4 style="color: #1e293b; margin-bottom: var(--spacing-md);">üìå Past Perfect Continuous is used for:</h4>
                
                <div class="usage-list" style="margin-top: var(--spacing-md);">
                  <li>
                    <strong>1. Ongoing Actions with Duration Before a Past Point</strong> - Actions that started before a point in the past and continued up to that point, emphasizing HOW LONG (with "for" or "since")
                    <div class="example-box" style="margin-top: var(--spacing-xs); margin-left: var(--spacing-md);">
                      <div class="example">When I arrived, she <span class="highlight">had been living</span> in Boston for 5 years. (She had been living there before I arrived - emphasis on duration)</div>
                      <div class="example">By 2020, he <span class="highlight">had been working</span> here since 2015. (He had been working before 2020 - emphasis on ongoing process)</div>
                      <div class="example">They <span class="highlight">had been studying</span> English for 2 years when they moved. (They had been studying before they moved - emphasis on how long)</div>
                      <p style="margin: var(--spacing-xs) 0 0 0; font-size: var(--font-size-sm); color: var(--color-text-muted); font-style: italic;">
                        üí° These actions started before a point in the past and continued up to that point. We emphasize the duration and ongoing nature before another past event.
                      </p>
                    </div>
                  </li>
                  
                  <li style="margin-top: var(--spacing-md);">
                    <strong>2. Actions That Had Been Happening Before Another Past Event</strong> - Actions that had been ongoing before something else happened in the past
                    <div class="example-box" style="margin-top: var(--spacing-xs); margin-left: var(--spacing-md);">
                      <div class="example">When I called, she <span class="highlight">had been studying</span> all morning. (She had been studying before I called)</div>
                      <div class="example">He <span class="highlight">had been waiting</span> for 30 minutes when the bus finally arrived. (He had been waiting before the bus arrived)</div>
                      <div class="example">They <span class="highlight">had been playing</span> soccer when it started raining. (They had been playing before it rained)</div>
                      <p style="margin: var(--spacing-xs) 0 0 0; font-size: var(--font-size-sm); color: var(--color-text-muted); font-style: italic;">
                        üí° These actions had been happening before another past event occurred. The action was ongoing up to that point.
                      </p>
                    </div>
                  </li>
                  
                  <li style="margin-top: var(--spacing-md);">
                    <strong>3. Temporary Situations Before a Past Point</strong> - Actions that were temporary and ongoing before a point in the past
                    <div class="example-box" style="margin-top: var(--spacing-xs); margin-left: var(--spacing-md);">
                      <div class="example">Before she moved, she <span class="highlight">had been staying</span> with her friend for a week. (temporary situation before moving)</div>
                      <div class="example">By the deadline, she <span class="highlight">had been working</span> on a special project for months. (temporary, ongoing work before deadline)</div>
                      <div class="example">He <span class="highlight">had been taking</span> extra classes before he graduated. (temporary, ongoing action before graduation)</div>
                      <p style="margin: var(--spacing-xs) 0 0 0; font-size: var(--font-size-sm); color: var(--color-text-muted); font-style: italic;">
                        üí° These were temporary situations that were ongoing before another past event, not permanent states.
                      </p>
                    </div>
                  </li>
                  
                  <li style="margin-top: var(--spacing-md);">
                    <strong>4. Repeated Actions Over Time Before a Past Point</strong> - Actions that had been repeated over a period of time before a point in the past
                    <div class="example-box" style="margin-top: var(--spacing-xs); margin-left: var(--spacing-md);">
                      <div class="example">Before he got injured, he <span class="highlight">had been going</span> to the gym regularly. (repeated action over time before injury)</div>
                      <div class="example">She <span class="highlight">had been calling</span> me every day until last week. (repeated action before last week)</div>
                      <div class="example">They <span class="highlight">had been meeting</span> every week before the pandemic started. (repeated action over time before pandemic)</div>
                      <p style="margin: var(--spacing-xs) 0 0 0; font-size: var(--font-size-sm); color: var(--color-text-muted); font-style: italic;">
                        üí° These actions had been repeated regularly over a period of time before another past event.
                      </p>
                    </div>
                  </li>
                  
                  <li style="margin-top: var(--spacing-md);">
                    <strong>5. Actions with Visible Results at a Past Point</strong> - Actions that had been happening and had visible results at a point in the past
                    <div class="example-box" style="margin-top: var(--spacing-xs); margin-left: var(--spacing-md);">
                      <div class="example">When I saw him, he looked tired. He <span class="highlight">had been working</span> all night. (visible result: he looked tired)</div>
                      <div class="example">When we arrived, the ground was wet. It <span class="highlight">had been raining</span>. (visible result: the ground was wet)</div>
                      <div class="example">She <span class="highlight">had been crying</span> when I found her. (visible result: red eyes, tears)</div>
                      <p style="margin: var(--spacing-xs) 0 0 0; font-size: var(--font-size-sm); color: var(--color-text-muted); font-style: italic;">
                        üí° The action had been happening and there was a visible result or effect at a point in the past.
                      </p>
                    </div>
                  </li>
                </div>
              </div>

              <div class="tip-box" style="margin-top: var(--spacing-lg);">
                <strong>üí° Key Point:</strong> 
                <p style="margin: var(--spacing-xs) 0 0 0;">Past Perfect Continuous emphasizes the <strong>duration</strong> and <strong>ongoing process</strong> of actions that started before a point in the past and continued up to that point. It's used when we want to focus on <strong>how long</strong> something had been happening before another past event or the <strong>process</strong> itself, not just the result.</p>
                <p style="margin: var(--spacing-xs) 0 0 0;"><strong>Compare:</strong></p>
                <ul style="margin: var(--spacing-xs) 0; padding-left: var(--spacing-lg);">
                  <li>"When I arrived, she <strong>had been living</strong> in Boston for 5 years" (Past Perfect Continuous - emphasizes duration and ongoing process before I arrived)</li>
                  <li>"When I arrived, she <strong>had lived</strong> in Boston for 5 years" (Past Perfect Simple - emphasizes the result/fact before I arrived)</li>
                  <li>"She <strong>lived</strong> in Boston in 2019" (Past Simple - specific time in the past, finished action)</li>
                </ul>
              </div>
            </div>

            <!-- Practice: Understanding Meaning -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="lightbulb" style="width: 24px; height: 24px;"></i>
                Practice: Why Do We Use Past Perfect Continuous Here?
              </div>
              <p class="exercise-instructions">Read each sentence and choose why we use Past Perfect Continuous. Think about the meaning!</p>
              
              <div class="exercise-item">
                <label>1. "When I arrived, she had been living in Boston for 5 years."</label>
                <select id="meaning-1">
                  <option value="">Choose...</option>
                  <option value="duration">Ongoing Actions with Duration Before a Past Point</option>
                  <option value="recent">Actions That Had Been Happening Before Another Past Event</option>
                  <option value="temporary">Temporary Situations Before a Past Point</option>
                  <option value="repeated">Repeated Actions Over Time Before a Past Point</option>
                  <option value="visible">Actions with Visible Results at a Past Point</option>
                </select>
              </div>
              
              <div class="exercise-item">
                <label>2. "When I called, she had been studying all morning."</label>
                <select id="meaning-2">
                  <option value="">Choose...</option>
                  <option value="duration">Ongoing Actions with Duration Before a Past Point</option>
                  <option value="recent">Actions That Had Been Happening Before Another Past Event</option>
                  <option value="temporary">Temporary Situations Before a Past Point</option>
                  <option value="repeated">Repeated Actions Over Time Before a Past Point</option>
                  <option value="visible">Actions with Visible Results at a Past Point</option>
                </select>
              </div>
              
              <div class="exercise-item">
                <label>3. "Before she moved, she had been staying with her friend for a week."</label>
                <select id="meaning-3">
                  <option value="">Choose...</option>
                  <option value="duration">Ongoing Actions with Duration Before a Past Point</option>
                  <option value="recent">Actions That Had Been Happening Before Another Past Event</option>
                  <option value="temporary">Temporary Situations Before a Past Point</option>
                  <option value="repeated">Repeated Actions Over Time Before a Past Point</option>
                  <option value="visible">Actions with Visible Results at a Past Point</option>
                </select>
              </div>
              
              <div class="exercise-item">
                <label>4. "When we arrived, the ground was wet. It had been raining."</label>
                <select id="meaning-4">
                  <option value="">Choose...</option>
                  <option value="duration">Ongoing Actions with Duration Before a Past Point</option>
                  <option value="recent">Actions That Had Been Happening Before Another Past Event</option>
                  <option value="temporary">Temporary Situations Before a Past Point</option>
                  <option value="repeated">Repeated Actions Over Time Before a Past Point</option>
                  <option value="visible">Actions with Visible Results at a Past Point</option>
                </select>
              </div>
              
              <div class="exercise-item">
                <label>5. "Before he got injured, he had been going to the gym regularly."</label>
                <select id="meaning-5">
                  <option value="">Choose...</option>
                  <option value="duration">Ongoing Actions with Duration Before a Past Point</option>
                  <option value="recent">Actions That Had Been Happening Before Another Past Event</option>
                  <option value="temporary">Temporary Situations Before a Past Point</option>
                  <option value="repeated">Repeated Actions Over Time Before a Past Point</option>
                  <option value="visible">Actions with Visible Results at a Past Point</option>
                </select>
              </div>
              
              <button class="check-button" onclick="checkMeaningExercise()">
                <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                Check My Answers
              </button>
              <div id="feedback-meaning" class="feedback"></div>
            </div>
          </div>

          <!-- VERB + -ING FORM SECTION -->
          <div class="step-section" style="background: linear-gradient(135deg, rgba(236, 72, 153, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%); border-color: #ec4899;">
            <div class="step-header">
              <span class="step-number" style="background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);">üìö</span>
              <h2 class="step-title">Understanding Verb + -ing Form - The Key to Past Perfect Continuous!</h2>
            </div>

            <div class="explanation-box" style="background: white;">
              <h3 style="color: #ec4899; margin-top: 0;">What is the -ing form?</h3>
              <p>The <strong>verb + -ing</strong> form (also called the present participle) is essential for Past Perfect Continuous! You need <span class="highlight">had + been + verb + -ing</span> to make Past Perfect Continuous sentences.</p>
              
              <div style="margin: var(--spacing-lg) 0;">
                <h4 style="color: #ec4899; margin-bottom: var(--spacing-md);">üîë How to Form -ing</h4>
                <p>For most verbs, you just add <strong>-ing</strong> to the base form:</p>
                
                <div class="example-box" style="margin-top: var(--spacing-md);">
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-sm);">
                    <div><strong>Base Form</strong> ‚Üí <strong>Verb + -ing</strong></div>
                    <div>work ‚Üí <span class="highlight">working</span></div>
                    <div>play ‚Üí <span class="highlight">playing</span></div>
                    <div>study ‚Üí <span class="highlight">studying</span></div>
                    <div>live ‚Üí <span class="highlight">living</span></div>
                    <div>visit ‚Üí <span class="highlight">visiting</span></div>
                    <div>finish ‚Üí <span class="highlight">finishing</span></div>
                    <div>read ‚Üí <span class="highlight">reading</span></div>
                    <div>write ‚Üí <span class="highlight">writing</span></div>
                  </div>
                </div>

                <div class="tip-box" style="margin-top: var(--spacing-md);">
                  <strong>üí° Spelling Rules for -ing:</strong>
                  <ul style="margin: var(--spacing-xs) 0; padding-left: var(--spacing-lg);">
                    <li>Most verbs: add <strong>-ing</strong> (work ‚Üí working, play ‚Üí playing)</li>
                    <li>Verbs ending in -e: drop the -e and add <strong>-ing</strong> (live ‚Üí living, write ‚Üí writing)</li>
                    <li>Verbs ending in -ie: change -ie to -y and add <strong>-ing</strong> (lie ‚Üí lying, die ‚Üí dying)</li>
                    <li>One-syllable verbs ending in consonant-vowel-consonant: double the last letter and add <strong>-ing</strong> (run ‚Üí running, sit ‚Üí sitting)</li>
                    <li>Two-syllable verbs ending in consonant-vowel-consonant with stress on last syllable: double the last letter (begin ‚Üí beginning, prefer ‚Üí preferring)</li>
                  </ul>
                </div>
              </div>

              <div class="example-box" style="margin-top: var(--spacing-lg);">
                <strong style="color: #ec4899;">Examples in Past Perfect Continuous:</strong>
                <div class="example">When I arrived, I <span class="highlight">had been working</span> here for 5 years.</div>
                <div class="example">She <span class="highlight">had been studying</span> English before she moved.</div>
                <div class="example">They <span class="highlight">had been playing</span> soccer when it started raining.</div>
                <div class="example">We <span class="highlight">had been living</span> in Boston before we moved to New York.</div>
              </div>

              <div class="tip-box" style="margin-top: var(--spacing-lg);">
                <strong>üí° Important:</strong> 
                <p style="margin: var(--spacing-xs) 0 0 0;">Remember: Past Perfect Continuous uses <strong>had + been + verb + -ing</strong>. The "been" is always there! Don't forget it! All subjects use "had" (not "have" or "has").</p>
                <p style="margin: var(--spacing-xs) 0 0 0;">‚úÖ Correct: "I had been studying" | ‚ùå Wrong: "I had studying" or "I have been studying"</p>
              </div>
            </div>
          </div>

          <!-- PAST PERFECT SIMPLE VS CONTINUOUS SECTION -->
          <div class="step-section" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(99, 102, 241, 0.05) 100%); border-color: #1e293b;">
            <div class="step-header">
              <span class="step-number" style="background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);">‚öñÔ∏è</span>
              <h2 class="step-title">Past Perfect Simple vs Continuous - What's the Difference?</h2>
            </div>

            <div class="explanation-box" style="background: white;">
              <h3 style="color: #1e293b; margin-top: 0;">Why is this important?</h3>
              <p>Many students confuse Past Perfect Simple and Past Perfect Continuous. Understanding the difference helps you choose the correct tense! The key difference is what we <strong>emphasize</strong>.</p>
              
              <div style="margin: var(--spacing-lg) 0;">
                <h4 style="color: #1e293b; margin-bottom: var(--spacing-md);">üìä Key Differences</h4>
                
                <div class="example-box" style="margin-top: var(--spacing-md);">
                  <div style="border-left: 4px solid #6366f1; padding-left: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                    <h4 style="color: #1e293b; margin-top: 0;">Past Perfect Simple</h4>
                    <ul style="margin: var(--spacing-xs) 0; padding-left: var(--spacing-lg);">
                      <li>‚úÖ Emphasizes the <strong>result</strong> or <strong>completion</strong> of an action before a past point</li>
                      <li>‚úÖ Focuses on <strong>what</strong> had been done</li>
                      <li>‚úÖ Used for <strong>finished actions</strong> before another past event</li>
                      <li>‚úÖ Form: <strong>Subject + had + past participle</strong></li>
                    </ul>
                    <div style="margin-top: var(--spacing-sm);">
                      <strong>Examples:</strong>
                      <div class="example">When I arrived, she <span class="highlight">had finished</span> her homework. (result: it was done before I arrived)</div>
                      <div class="example">By 2020, she <span class="highlight">had lived</span> here for 5 years. (fact: she had lived here before 2020)</div>
                      <div class="example">They <span class="highlight">had seen</span> that movie before we watched it. (result: they knew the movie)</div>
                    </div>
                  </div>

                  <div style="border-left: 4px solid #ec4899; padding-left: var(--spacing-md);">
                    <h4 style="color: #ec4899; margin-top: 0;">Past Perfect Continuous</h4>
                    <ul style="margin: var(--spacing-xs) 0; padding-left: var(--spacing-lg);">
                      <li>‚úÖ Emphasizes the <strong>duration</strong> and <strong>ongoing process</strong> before a past point</li>
                      <li>‚úÖ Focuses on <strong>how long</strong> something had been happening</li>
                      <li>‚úÖ Used for <strong>ongoing actions</strong> that started before a point in the past</li>
                      <li>‚úÖ Form: <strong>Subject + had + been + verb + -ing</strong></li>
                    </ul>
                    <div style="margin-top: var(--spacing-sm);">
                      <strong>Examples:</strong>
                      <div class="example">When I called, she <span class="highlight">had been studying</span> all morning. (process: how long she had been studying)</div>
                      <div class="example">By 2020, she <span class="highlight">had been living</span> here for 5 years. (duration: emphasis on the 5 years)</div>
                      <div class="example">They <span class="highlight">had been watching</span> TV when I arrived. (ongoing: they had been watching before I arrived)</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="tip-box" style="margin-top: var(--spacing-lg);">
                <strong>üí° Quick Test:</strong> 
                <p style="margin: var(--spacing-xs) 0 0 0;">Ask yourself: <strong>"What do I want to emphasize?"</strong></p>
                <ul style="margin: var(--spacing-xs) 0; padding-left: var(--spacing-lg);">
                  <li>Result/Completion ‚Üí <strong>Past Perfect Simple</strong> (had + past participle)</li>
                  <li>Duration/Ongoing Process ‚Üí <strong>Past Perfect Continuous</strong> (had + been + verb-ing)</li>
                </ul>
              </div>

              <div class="example-box" style="margin-top: var(--spacing-lg);">
                <strong style="color: #1e293b;">Side-by-Side Comparison:</strong>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md); margin-top: var(--spacing-sm);">
                  <div>
                    <strong>Past Perfect Simple:</strong>
                    <div class="example">When I arrived, she <span class="highlight">had lived</span> here for 5 years. (emphasizes the fact)</div>
                    <div class="example">By 2020, she <span class="highlight">had worked</span> here since 2015. (emphasizes the result)</div>
                    <div class="example">They <span class="highlight">had finished</span> the project when I called. (emphasizes completion)</div>
                  </div>
                  <div>
                    <strong>Past Perfect Continuous:</strong>
                    <div class="example">When I arrived, she <span class="highlight">had been living</span> here for 5 years. (emphasizes duration)</div>
                    <div class="example">By 2020, she <span class="highlight">had been working</span> here since 2015. (emphasizes ongoing process)</div>
                    <div class="example">They <span class="highlight">had been working</span> on the project when I called. (emphasizes the process, not finished)</div>
                  </div>
                </div>
              </div>

              <div class="tip-box" style="margin-top: var(--spacing-lg);">
                <strong>üí° Important Notes:</strong>
                <ul style="margin: var(--spacing-xs) 0; padding-left: var(--spacing-lg);">
                  <li>Some verbs (like "live", "work", "study") can use BOTH forms - the meaning is similar, but the emphasis is different</li>
                  <li>State verbs (like "know", "like", "want") CANNOT use Past Perfect Continuous - only Past Perfect Simple</li>
                  <li>When asking "How long...?" about past actions, we usually use Past Perfect Continuous: "How long had you been studying?"</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- TIME EXPRESSIONS: FOR/SINCE/ALREADY/YET/JUST SECTION -->
          <div class="step-section" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(5, 150, 105, 0.05) 100%); border-color: #10b981;">
            <div class="step-header">
              <span class="step-number" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">‚è∞</span>
              <h2 class="step-title">Time Expressions: For / Since</h2>
            </div>

            <div class="explanation-box" style="background: white;">
              <h3 style="color: #10b981; margin-top: 0;">Why are these words important?</h3>
              <p><strong>FOR</strong> and <strong>SINCE</strong> are <strong>very common</strong> with Past Perfect Continuous! They help show the <strong>duration</strong> of ongoing actions before a point in the past, which is exactly what Past Perfect Continuous emphasizes.</p>
              
              <div style="margin: var(--spacing-lg) 0;">
                <h4 style="color: #10b981; margin-bottom: var(--spacing-md);">üìÖ FOR vs SINCE</h4>
                <p><strong>FOR</strong> and <strong>SINCE</strong> both show duration before a point in the past, but they're used differently:</p>
                
                <div class="example-box" style="margin-top: var(--spacing-md);">
                  <div style="border-left: 4px solid #10b981; padding-left: var(--spacing-md); margin-bottom: var(--spacing-md);">
                    <h4 style="color: #10b981; margin-top: 0;">FOR = a period of time</h4>
                    <p>Use <strong>FOR</strong> with a <strong>duration</strong> (how long):</p>
                    <ul style="margin: var(--spacing-xs) 0; padding-left: var(--spacing-lg);">
                      <li>for 5 years</li>
                      <li>for 2 months</li>
                      <li>for a week</li>
                      <li>for a long time</li>
                      <li>for 10 minutes</li>
                      <li>for hours</li>
                      <li>for ages</li>
                    </ul>
                    <div style="margin-top: var(--spacing-sm);">
                      <strong>Examples:</strong>
                      <div class="example">When I arrived, she <span class="highlight">had been living</span> here <strong>for 5 years</strong>.</div>
                      <div class="example">By last month, she <span class="highlight">had been working</span> here <strong>for 2 months</strong>.</div>
                      <div class="example">Before they moved, they <span class="highlight">had been studying</span> English <strong>for a long time</strong>.</div>
                      <div class="example">When the bus arrived, they <span class="highlight">had been waiting</span> <strong>for hours</strong>.</div>
                    </div>
                  </div>

                  <div style="border-left: 4px solid #059669; padding-left: var(--spacing-md);">
                    <h4 style="color: #059669; margin-top: 0;">SINCE = a starting point</h4>
                    <p>Use <strong>SINCE</strong> with a <strong>point in time</strong> (when it started):</p>
                    <ul style="margin: var(--spacing-xs) 0; padding-left: var(--spacing-lg);">
                      <li>since 2020</li>
                      <li>since January</li>
                      <li>since last week</li>
                      <li>since I was a child</li>
                      <li>since Monday</li>
                      <li>since this morning</li>
                      <li>since 9 o'clock</li>
                    </ul>
                    <div style="margin-top: var(--spacing-sm);">
                      <strong>Examples:</strong>
                      <div class="example">When I arrived in 2020, she <span class="highlight">had been living</span> here <strong>since 2015</strong>.</div>
                      <div class="example">By last month, she <span class="highlight">had been working</span> here <strong>since January</strong>.</div>
                      <div class="example">Before they moved, they <span class="highlight">had been studying</span> English <strong>since last year</strong>.</div>
                      <div class="example">When I called at 10 o'clock, he <span class="highlight">had been waiting</span> <strong>since 9 o'clock</strong>.</div>
                    </div>
                  </div>
                </div>

                <div class="tip-box" style="margin-top: var(--spacing-md);">
                  <strong>üí° Memory Trick:</strong> 
                  <p style="margin: var(--spacing-xs) 0 0 0;"><strong>FOR</strong> = "how long" (duration) | <strong>SINCE</strong> = "when it started" (point in time)</p>
                  <p style="margin: var(--spacing-xs) 0 0 0;">Both <strong>FOR</strong> and <strong>SINCE</strong> are perfect for Past Perfect Continuous because they emphasize duration before a past point!</p>
                </div>
              </div>

              <div class="tip-box" style="margin-top: var(--spacing-lg);">
                <strong>üí° Summary:</strong>
                <ul style="margin: var(--spacing-xs) 0; padding-left: var(--spacing-lg);">
                  <li><strong>FOR</strong> + period (for 5 years, for 2 months, for hours) - emphasizes duration</li>
                  <li><strong>SINCE</strong> + starting point (since 2020, since Monday, since 9 o'clock) - emphasizes when it started</li>
                  <li>Both work perfectly with Past Perfect Continuous to show ongoing actions with duration before a past point!</li>
                </ul>
              </div>
            </div>

            <!-- Practice: Time Expressions For/Since -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="clock" style="width: 24px; height: 24px;"></i>
                Practice: Identify FOR or SINCE
              </div>
              <p class="exercise-instructions">Read each sentence and identify whether "for" or "since" is used.</p>
              
              <div class="exercise-item">
                <label>1. "When I arrived, she had been living here for 5 years."</label>
                <input type="text" id="time-ex1" placeholder="for or since?">
                <div style="font-size: var(--font-size-sm); color: var(--color-text-muted); margin-top: var(--spacing-xs);">Hint: Is it a duration (for) or a starting point (since)?</div>
              </div>
              
              <div class="exercise-item">
                <label>2. "By 2020, she had been working here since 2015."</label>
                <input type="text" id="time-ex2" placeholder="for or since?">
              </div>
              
              <div class="exercise-item">
                <label>3. "When I called, they had been studying for 2 hours."</label>
                <input type="text" id="time-ex3" placeholder="for or since?">
              </div>
              
              <button class="check-button" onclick="checkTimeExpressions()">
                <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                Check My Answers
              </button>
              <div id="feedback-time" class="feedback"></div>
            </div>
          </div>

          <!-- STATE VERBS VS ACTION VERBS SECTION -->
          <div class="step-section" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(99, 102, 241, 0.05) 100%); border-color: #1e293b;">
            <div class="step-header">
              <span class="step-number" style="background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);">üîë</span>
              <h2 class="step-title">State Verbs vs Action Verbs - Why We Can't Say "I Am Liking"</h2>
            </div>

            <div class="explanation-box" style="background: white;">
              <h3 style="color: #1e293b; margin-top: 0;">What's the difference?</h3>
              <p>Some verbs describe <strong>states</strong> (how things are) and some describe <strong>actions</strong> (what we do). This is important because <strong>state verbs don't use continuous forms</strong> - only action verbs can use Past Perfect Continuous!</p>
              
              <div style="margin: var(--spacing-lg) 0;">
                <h4 style="color: #1e293b; margin-bottom: var(--spacing-md);">üî¥ State Verbs (No Continuous Forms)</h4>
                <p>State verbs describe <strong>states, feelings, thoughts, or senses</strong>. These verbs are NOT used in continuous forms (not "am liking", "am knowing", "am wanting").</p>
                
                <div class="example-box" style="margin-top: var(--spacing-md);">
                  <strong style="color: #1e293b;">Common State Verbs:</strong>
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-sm); margin-top: var(--spacing-sm);">
                    <div><strong>Like, love, hate, prefer</strong> (feelings)</div>
                    <div><strong>Know, understand, believe</strong> (thoughts)</div>
                    <div><strong>Want, need, own</strong> (possession/desire)</div>
                    <div><strong>See, hear, smell, taste</strong> (senses)</div>
                    <div><strong>Be, seem, appear</strong> (states)</div>
                    <div><strong>Have</strong> (when meaning "own")</div>
                  </div>
                </div>

                <div class="example-box" style="margin-top: var(--spacing-md);">
                  <strong style="color: #1e293b;">Examples (Correct):</strong>
                  <div class="example">I <span class="highlight">like</span> chocolate. ‚úÖ (NOT "I am liking")</div>
                  <div class="example">She <span class="highlight">knows</span> the answer. ‚úÖ (NOT "She is knowing")</div>
                  <div class="example">They <span class="highlight">want</span> to go. ‚úÖ (NOT "They are wanting")</div>
                  <div class="example">I <span class="highlight">understand</span> English. ‚úÖ (NOT "I am understanding")</div>
                  <p style="margin: var(--spacing-xs) 0 0 0; font-size: var(--font-size-sm); color: var(--color-text-muted); font-style: italic;">
                    üí° These verbs describe states, so we use Past Perfect Simple, not Past Perfect Continuous.
                  </p>
                </div>
              </div>

              <div style="margin: var(--spacing-lg) 0;">
                <h4 style="color: #1e293b; margin-bottom: var(--spacing-md);">üü¢ Action Verbs (Can Use Continuous Forms)</h4>
                <p>Action verbs describe <strong>actions or activities</strong>. These verbs CAN use continuous forms when the action is happening now.</p>
                
                <div class="example-box" style="margin-top: var(--spacing-md);">
                  <strong style="color: #1e293b;">Common Action Verbs:</strong>
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-sm); margin-top: var(--spacing-sm);">
                    <div><strong>Run, walk, jump</strong> (movement)</div>
                    <div><strong>Eat, drink, cook</strong> (activities)</div>
                    <div><strong>Study, work, read</strong> (activities)</div>
                    <div><strong>Play, watch, listen</strong> (activities)</div>
                    <div><strong>Write, speak, talk</strong> (communication)</div>
                  </div>
                </div>

                <div class="example-box" style="margin-top: var(--spacing-md);">
                  <strong style="color: #1e293b;">Examples:</strong>
                  <div class="example">I <span class="highlight">eat</span> breakfast every day. (Present Simple - habit)</div>
                  <div class="example">When I arrived, I <span class="highlight">had been eating</span> breakfast. (Past Perfect Continuous - had been happening before I arrived) ‚úÖ</div>
                  <div class="example">She <span class="highlight">worked</span> at a hospital. (Past Simple - finished action)</div>
                  <div class="example">When I called, she <span class="highlight">had been working</span> on a project. (Past Perfect Continuous - had been happening before I called) ‚úÖ</div>
                </div>
              </div>

              <div class="tip-box" style="margin-top: var(--spacing-lg);">
                <strong>üí° Key Point:</strong> 
                <p style="margin: var(--spacing-xs) 0 0 0;">State verbs describe <strong>how things ARE</strong> (states, feelings, thoughts). Action verbs describe <strong>what we DO</strong> (activities, movements).</p>
                <p style="margin: var(--spacing-xs) 0 0 0;"><strong>Remember:</strong></p>
                <ul style="margin: var(--spacing-xs) 0; padding-left: var(--spacing-lg);">
                  <li>State verbs ‚Üí Use Present Simple only (I like, I know, I want) - NO continuous forms!</li>
                  <li>Action verbs ‚Üí Can use Past Simple (finished actions) OR Past Perfect Continuous (had been happening before a past point)</li>
                  <li><strong>Never say:</strong> "I am liking", "I am knowing", "I am wanting" ‚ùå</li>
                  <li><strong>Can say:</strong> "I am eating", "I am studying", "I am working" ‚úÖ (action verbs)</li>
                </ul>
              </div>
            </div>

            <!-- Practice: State Verbs vs Action Verbs -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="help-circle" style="width: 24px; height: 24px;"></i>
                Practice: State Verb or Action Verb?
              </div>
              <p class="exercise-instructions">Read each sentence and decide if the verb is a state verb or action verb. Remember: state verbs don't use continuous forms!</p>
              
              <div class="exercise-item">
                <label>1. "I like pizza."</label>
                <select id="state-verb-1">
                  <option value="">Choose...</option>
                  <option value="state">State Verb (no continuous)</option>
                  <option value="action">Action Verb (can use continuous)</option>
                </select>
              </div>
              
              <div class="exercise-item">
                <label>2. "She is eating pizza."</label>
                <select id="state-verb-2">
                  <option value="">Choose...</option>
                  <option value="state">State Verb (no continuous)</option>
                  <option value="action">Action Verb (can use continuous)</option>
                </select>
              </div>
              
              <div class="exercise-item">
                <label>3. "I know the answer."</label>
                <select id="state-verb-3">
                  <option value="">Choose...</option>
                  <option value="state">State Verb (no continuous)</option>
                  <option value="action">Action Verb (can use continuous)</option>
                </select>
              </div>
              
              <div class="exercise-item">
                <label>4. "They are studying English."</label>
                <select id="state-verb-4">
                  <option value="">Choose...</option>
                  <option value="state">State Verb (no continuous)</option>
                  <option value="action">Action Verb (can use continuous)</option>
                </select>
              </div>
              
              <div class="exercise-item">
                <label>5. "I want a new car."</label>
                <select id="state-verb-5">
                  <option value="">Choose...</option>
                  <option value="state">State Verb (no continuous)</option>
                  <option value="action">Action Verb (can use continuous)</option>
                </select>
              </div>
              
              <button class="check-button" onclick="checkStateVerbs()">
                <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                Check My Answers
              </button>
              <div id="feedback-state-verbs" class="feedback"></div>
            </div>
          </div>

          <!-- Progress Indicator -->
          <div class="progress-indicator">
            <p style="margin: 0; color: var(--color-text-muted); font-size: var(--font-size-sm);">Your Progress</p>
            <div class="progress-bar">
              <div class="progress-dot active" id="dot1"></div>
              <div class="progress-dot" id="dot2"></div>
              <div class="progress-dot" id="dot3"></div>
              <div class="progress-dot" id="dot4"></div>
            </div>
          </div>

          <!-- STEP 1: AFFIRMATIVE -->
          <div class="step-section" id="step1">
            <div class="step-header">
              <span class="step-number">1</span>
              <h2 class="step-title">Past Perfect Continuous - Positive (Affirmative) Sentences</h2>
            </div>

            <div class="explanation-box">
              <h3 style="color: #1e293b; margin-top: 0;">What are positive sentences?</h3>
              <p>Positive sentences tell us what someone <strong>had done</strong> or <strong>had been doing</strong>. They're not negative (saying "no") and they're not questions.</p>
              
              <div class="formula-box">
                <div style="margin-bottom: var(--spacing-sm);">
                  <span class="formula-part subject-part">I/You/We/They/He/She/It</span>
                  <span style="margin: 0 var(--spacing-xs);">+</span>
                  <span class="formula-part verb-part">had</span>
                  <span style="margin: 0 var(--spacing-xs);">+</span>
                  <span class="formula-part verb-part">been</span>
                  <span style="margin: 0 var(--spacing-xs);">+</span>
                  <span class="formula-part object-part">verb + -ing</span>
                </div>
                <div style="font-size: var(--font-size-sm); color: var(--color-text-muted); margin-top: var(--spacing-xs);">
                  ‚ö†Ô∏è Important: All subjects use <span class="highlight">had</span> (not "have" or "has")! Don't forget <span class="highlight">been</span>!
                </div>
              </div>

              <div class="example-box">
                <strong style="color: #1e293b;">Look at these examples:</strong>
                <div class="example">When I called, I <span class="highlight">had been studying</span> all morning. (I + had + been + studying)</div>
                <div class="example">By last year, she <span class="highlight">had been working</span> here for 5 years. (She + had + been + working)</div>
                <div class="example">Before they moved, they <span class="highlight">had been living</span> here for 2 months. (They + had + been + living)</div>
                <div class="example">When the bus arrived, he <span class="highlight">had been waiting</span> for 30 minutes. (He + had + been + waiting)</div>
                <div class="example">Before they graduated, we <span class="highlight">had been learning</span> English for 2 years. (We + had + been + learning)</div>
                <div class="example">By 2020, Maria <span class="highlight">had been teaching</span> here since 2015. (Maria + had + been + teaching)</div>
              </div>

              <div class="tip-box">
                <strong>üí° Remember:</strong> 
                <ul style="margin: var(--spacing-xs) 0; padding-left: var(--spacing-lg);">
                  <li>All subjects (I, you, we, they, he, she, it) ‚Üí use <strong>had + been + verb + -ing</strong></li>
                  <li>Remember to use the <strong>verb + -ing</strong> form (studying, working, living, etc.)</li>
                  <li>Don't forget <strong>been</strong>! It's always there in Past Perfect Continuous!</li>
                  <li>Most verbs: add <strong>-ing</strong> (work ‚Üí working, study ‚Üí studying)</li>
                  <li>Past Perfect Continuous shows actions that had been happening before another past event</li>
                </ul>
              </div>
            </div>

            <!-- Practice Exercise 1 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="edit-3" style="width: 24px; height: 24px;"></i>
                Practice: Fill in the Blank (Positive Sentences)
              </div>
              <p class="exercise-instructions">Choose the correct form: had + been + verb + -ing. Remember: All subjects use "had"!</p>
              
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">1.</span>
                  <span class="fill-blank-clause">
                    <span>When I arrived, she</span>
                    <input type="text" id="ex1-1" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">here for 5 years. (<strong>work</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">2.</span>
                  <span class="fill-blank-clause">
                    <span>Before they moved, they</span>
                    <input type="text" id="ex1-2" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">in Boston for 2 months. (<strong>live</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">3.</span>
                  <span class="fill-blank-clause">
                    <span>When I asked, he</span>
                    <input type="text" id="ex1-3" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">that movie. (<strong>see</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">4.</span>
                  <span class="fill-blank-clause">
                    <span>When I called, I</span>
                    <input type="text" id="ex1-4" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">my homework. (<strong>finish</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">5.</span>
                  <span class="fill-blank-clause">
                    <span>By 2020, Maria</span>
                    <input type="text" id="ex1-5" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">to Paris twice. (<strong>be</strong>)</span>
                </p>
              </div>
              
              <button class="check-button" onclick="checkExercise1()">
                <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                Check My Answers
              </button>
              <div id="feedback1" class="feedback"></div>
            </div>

            <!-- Practice Exercise 2 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="list" style="width: 24px; height: 24px;"></i>
                More Practice: Multiple Choice
              </div>
              <p class="exercise-instructions">Choose the correct answer for each sentence.</p>
              
              <div class="exercise-item">
                <label>1. When I arrived, she _____ here for 5 years.</label>
                <select id="ex1b-1">
                  <option value="">Choose...</option>
                  <option value="had been working">had been working</option>
                  <option value="has been working">has been working</option>
                  <option value="worked">worked</option>
                </select>
              </div>
              <div class="exercise-item">
                <label>2. Before they moved, they _____ in Boston for 2 months.</label>
                <select id="ex1b-2">
                  <option value="">Choose...</option>
                  <option value="had been living">had been living</option>
                  <option value="have been living">have been living</option>
                  <option value="lived">lived</option>
                </select>
              </div>
              <div class="exercise-item">
                <label>3. When I asked, he _____ that movie.</label>
                <select id="ex1b-3">
                  <option value="">Choose...</option>
                  <option value="had been seeing">had been seeing</option>
                  <option value="has been seeing">has been seeing</option>
                  <option value="saw">saw</option>
                </select>
              </div>
              <div class="exercise-item">
                <label>4. When I called, I _____ my homework.</label>
                <select id="ex1b-4">
                  <option value="">Choose...</option>
                  <option value="had been finishing">had been finishing</option>
                  <option value="have been finishing">have been finishing</option>
                  <option value="finished">finished</option>
                </select>
              </div>
              
              <button class="check-button" onclick="checkExercise1b()">
                <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                Check My Answers
              </button>
              <div id="feedback1b" class="feedback"></div>
            </div>

            <!-- Scrambled Sentences Exercise -->
            <div class="word-scramble-section">
              <div class="exercise-title">
                <i data-lucide="shuffle" style="width: 24px; height: 24px;"></i>
                Scrambled Sentences: Put the Words in Order (Positive Sentences)
              </div>
              <p class="exercise-instructions">Put the words in the correct order to make positive Past Perfect Continuous sentences. Type your answer in the box below each set of words.</p>
              
              <div class="exercise-item">
                <label>1. Put these words in order:</label>
                <div class="word-cards">
                  <span class="word-card">working</span>
                  <span class="word-card">here</span>
                  <span class="word-card">for</span>
                  <span class="word-card">been</span>
                  <span class="word-card">had</span>
                  <span class="word-card">she</span>
                  <span class="word-card">5</span>
                  <span class="word-card">years</span>
                  <span class="word-card">arrived</span>
                  <span class="word-card">I</span>
                  <span class="word-card">When</span>
                </div>
                <input type="text" class="scramble-input" id="scramble1-1" placeholder="Type the sentence here...">
                <div class="scramble-hint">Hint: Start with "When"</div>
              </div>
              
              <div class="exercise-item">
                <label>2. Put these words in order:</label>
                <div class="word-cards">
                  <span class="word-card">homework</span>
                  <span class="word-card">my</span>
                  <span class="word-card">finishing</span>
                  <span class="word-card">been</span>
                  <span class="word-card">had</span>
                  <span class="word-card">I</span>
                  <span class="word-card">called</span>
                  <span class="word-card">When</span>
                </div>
                <input type="text" class="scramble-input" id="scramble1-2" placeholder="Type the sentence here...">
                <div class="scramble-hint">Hint: Start with "When"</div>
              </div>
              
              <div class="exercise-item">
                <label>3. Put these words in order:</label>
                <div class="word-cards">
                  <span class="word-card">been</span>
                  <span class="word-card">to</span>
                  <span class="word-card">Paris</span>
                  <span class="word-card">twice</span>
                  <span class="word-card">had</span>
                  <span class="word-card">Maria</span>
                  <span class="word-card">2020</span>
                  <span class="word-card">By</span>
                </div>
                <input type="text" class="scramble-input" id="scramble1-3" placeholder="Type the sentence here...">
                <div class="scramble-hint">Hint: Start with "By"</div>
              </div>
              
              <div class="exercise-item">
                <label>4. Put these words in order:</label>
                <div class="word-cards">
                  <span class="word-card">for</span>
                  <span class="word-card">years</span>
                  <span class="word-card">English</span>
                  <span class="word-card">studying</span>
                  <span class="word-card">been</span>
                  <span class="word-card">had</span>
                  <span class="word-card">we</span>
                  <span class="word-card">2</span>
                  <span class="word-card">moved</span>
                  <span class="word-card">Before</span>
                  <span class="word-card">they</span>
                </div>
                <input type="text" class="scramble-input" id="scramble1-4" placeholder="Type the sentence here...">
                <div class="scramble-hint">Hint: Start with "Before"</div>
              </div>
              
              <div class="exercise-item">
                <label>5. Put these words in order:</label>
                <div class="word-cards">
                  <span class="word-card">that</span>
                  <span class="word-card">movie</span>
                  <span class="word-card">seeing</span>
                  <span class="word-card">been</span>
                  <span class="word-card">had</span>
                  <span class="word-card">they</span>
                  <span class="word-card">asked</span>
                  <span class="word-card">When</span>
                  <span class="word-card">I</span>
                </div>
                <input type="text" class="scramble-input" id="scramble1-5" placeholder="Type the sentence here...">
                <div class="scramble-hint">Hint: Start with "When"</div>
              </div>
              
              <button class="check-button" onclick="checkScramble1()">
                <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                Check My Answers
              </button>
              <div id="feedback-scramble1" class="feedback"></div>
            </div>

            <div class="tip-box" style="margin-top: var(--spacing-lg);">
              <strong>‚úÖ Great job!</strong> You've learned how to make positive sentences. When you're ready, scroll down to learn about negative sentences!
            </div>
          </div>

          <!-- STEP 2: NEGATIVE -->
          <div class="step-section" id="step2">
            <div class="step-header">
              <span class="step-number">2</span>
              <h2 class="step-title">Past Perfect Continuous - Negative Sentences</h2>
            </div>

            <div class="explanation-box">
              <h3 style="color: #1e293b; margin-top: 0;">What are negative sentences?</h3>
              <p>Negative sentences tell us what someone <strong>hadn't done</strong> or <strong>hadn't been doing</strong>. We add <span class="highlight">not</span> after had.</p>
              
              <div class="formula-box">
                <div style="margin-bottom: var(--spacing-sm);">
                  <span class="formula-part subject-part">I/You/We/They/He/She/It</span>
                  <span style="margin: 0 var(--spacing-xs);">+</span>
                  <span class="formula-part verb-part">had not/hadn't</span>
                  <span style="margin: 0 var(--spacing-xs);">+</span>
                  <span class="formula-part verb-part">been</span>
                  <span style="margin: 0 var(--spacing-xs);">+</span>
                  <span class="formula-part object-part">verb + -ing</span>
                </div>
                <div style="font-size: var(--font-size-sm); color: var(--color-text-muted); margin-top: var(--spacing-xs);">
                  ‚ö†Ô∏è Important: We can use contractions: <span class="highlight">hadn't</span> (had not)! All subjects use "hadn't".
                </div>
              </div>

              <div class="example-box">
                <strong style="color: #1e293b;">Look at these examples:</strong>
                <div class="example">When I called, I <span class="highlight">hadn't been finishing</span> my homework yet. (I + hadn't + been + finishing)</div>
                <div class="example">By last year, she <span class="highlight">hadn't been</span> to Paris. (She + hadn't + been)</div>
                <div class="example">When I asked, they <span class="highlight">hadn't been seeing</span> that movie. (They + hadn't + been + seeing)</div>
                <div class="example">When I arrived, he <span class="highlight">had not been calling</span> me. (He + had not + been + calling)</div>
                <div class="example">Before they moved, we <span class="highlight">hadn't been studying</span> Spanish. (We + hadn't + been + studying)</div>
                <div class="example">When I saw her, Maria <span class="highlight">hadn't been arriving</span> yet. (Maria + hadn't + been + arriving)</div>
              </div>

              <div class="tip-box">
                <strong>üí° Remember:</strong> 
                <ul style="margin: var(--spacing-xs) 0; padding-left: var(--spacing-lg);">
                  <li>All subjects ‚Üí use <strong>hadn't</strong> or <strong>had not</strong> + been + verb + -ing</li>
                  <li>Remember: <strong>hadn't</strong> = had not</li>
                  <li>Don't forget <strong>been</strong>! It's always there in Past Perfect Continuous!</li>
                </ul>
              </div>
            </div>

            <!-- Practice Exercise 3 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="x-circle" style="width: 24px; height: 24px;"></i>
                Practice: Make Negative Sentences
              </div>
              <p class="exercise-instructions">Change each positive sentence into a negative sentence. Use hadn't.</p>
              
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">1.</span>
                  <span class="fill-blank-clause">
                    <span>When I called, I</span>
                    <input type="text" id="ex2-1" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">my homework yet. (<strong>finish</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">2.</span>
                  <span class="fill-blank-clause">
                    <span>By last year, she</span>
                    <input type="text" id="ex2-2" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">to Paris. (<strong>be</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">3.</span>
                  <span class="fill-blank-clause">
                    <span>When I asked, they</span>
                    <input type="text" id="ex2-3" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">that movie. (<strong>see</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">4.</span>
                  <span class="fill-blank-clause">
                    <span>When I arrived, he</span>
                    <input type="text" id="ex2-4" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">me. (<strong>call</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">5.</span>
                  <span class="fill-blank-clause">
                    <span>Before they moved, we</span>
                    <input type="text" id="ex2-5" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">Spanish. (<strong>study</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">6.</span>
                  <span class="fill-blank-clause">
                    <span>When I saw her, Maria</span>
                    <input type="text" id="ex2-6" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">yet. (<strong>arrive</strong>)</span>
                </p>
              </div>
              
              <button class="check-button" onclick="checkExercise2()">
                <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                Check My Answers
              </button>
              <div id="feedback2" class="feedback"></div>
            </div>

            <!-- Practice Exercise 4 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="refresh-cw" style="width: 24px; height: 24px;"></i>
                More Practice: Positive or Negative?
              </div>
              <p class="exercise-instructions">Read each sentence and decide if it's positive or negative. Then rewrite it in the opposite form.</p>
              
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">1.</span>
                  <span class="fill-blank-clause">
                    <span>When I arrived, she</span>
                    <input type="text" id="ex2b-1" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">here for 5 years. (<strong>work</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">2.</span>
                  <span class="fill-blank-clause">
                    <span>Before they moved, they</span>
                    <input type="text" id="ex2b-2" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">in Boston for 2 months. (<strong>live</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">3.</span>
                  <span class="fill-blank-clause">
                    <span>When I asked, he</span>
                    <input type="text" id="ex2b-3" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">that movie. (<strong>see</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">4.</span>
                  <span class="fill-blank-clause">
                    <span>When I called, I</span>
                    <input type="text" id="ex2b-4" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">my homework. (<strong>finish</strong>)</span>
                </p>
              </div>
              
              <button class="check-button" onclick="checkExercise2b()">
                <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                Check My Answers
              </button>
              <div id="feedback2b" class="feedback"></div>
            </div>

            <!-- Scrambled Sentences Exercise - Negative -->
            <div class="word-scramble-section">
              <div class="exercise-title">
                <i data-lucide="shuffle" style="width: 24px; height: 24px;"></i>
                Scrambled Sentences: Put the Words in Order (Negative Sentences)
              </div>
              <p class="exercise-instructions">Put the words in the correct order to make negative Past Perfect Continuous sentences. Remember to use hadn't!</p>
              
              <div class="exercise-item">
                <label>1. Put these words in order:</label>
                <div class="word-cards">
                  <span class="word-card">homework</span>
                  <span class="word-card">yet</span>
                  <span class="word-card">finishing</span>
                  <span class="word-card">been</span>
                  <span class="word-card">hadn't</span>
                  <span class="word-card">I</span>
                  <span class="word-card">my</span>
                  <span class="word-card">called</span>
                  <span class="word-card">When</span>
                </div>
                <input type="text" class="scramble-input" id="scramble2-1" placeholder="Type the sentence here...">
                <div class="scramble-hint">Hint: Start with "When"</div>
              </div>
              
              <div class="exercise-item">
                <label>2. Put these words in order:</label>
                <div class="word-cards">
                  <span class="word-card">Paris</span>
                  <span class="word-card">to</span>
                  <span class="word-card">been</span>
                  <span class="word-card">hadn't</span>
                  <span class="word-card">she</span>
                  <span class="word-card">year</span>
                  <span class="word-card">last</span>
                  <span class="word-card">By</span>
                </div>
                <input type="text" class="scramble-input" id="scramble2-2" placeholder="Type the sentence here...">
                <div class="scramble-hint">Hint: Start with "By"</div>
              </div>
              
              <div class="exercise-item">
                <label>3. Put these words in order:</label>
                <div class="word-cards">
                  <span class="word-card">movie</span>
                  <span class="word-card">that</span>
                  <span class="word-card">seeing</span>
                  <span class="word-card">been</span>
                  <span class="word-card">hadn't</span>
                  <span class="word-card">they</span>
                  <span class="word-card">asked</span>
                  <span class="word-card">When</span>
                  <span class="word-card">I</span>
                </div>
                <input type="text" class="scramble-input" id="scramble2-3" placeholder="Type the sentence here...">
                <div class="scramble-hint">Hint: Start with "When"</div>
              </div>
              
              <div class="exercise-item">
                <label>4. Put these words in order:</label>
                <div class="word-cards">
                  <span class="word-card">me</span>
                  <span class="word-card">calling</span>
                  <span class="word-card">been</span>
                  <span class="word-card">hadn't</span>
                  <span class="word-card">he</span>
                  <span class="word-card">arrived</span>
                  <span class="word-card">When</span>
                  <span class="word-card">I</span>
                </div>
                <input type="text" class="scramble-input" id="scramble2-4" placeholder="Type the sentence here...">
                <div class="scramble-hint">Hint: Start with "When"</div>
              </div>
              
              <div class="exercise-item">
                <label>5. Put these words in order:</label>
                <div class="word-cards">
                  <span class="word-card">Spanish</span>
                  <span class="word-card">studying</span>
                  <span class="word-card">been</span>
                  <span class="word-card">hadn't</span>
                  <span class="word-card">we</span>
                  <span class="word-card">moved</span>
                  <span class="word-card">Before</span>
                  <span class="word-card">they</span>
                </div>
                <input type="text" class="scramble-input" id="scramble2-5" placeholder="Type the sentence here...">
                <div class="scramble-hint">Hint: Start with "Before"</div>
              </div>
              
              <button class="check-button" onclick="checkScramble2()">
                <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                Check My Answers
              </button>
              <div id="feedback-scramble2" class="feedback"></div>
            </div>

            <div class="tip-box" style="margin-top: var(--spacing-lg);">
              <strong>‚úÖ Excellent!</strong> You can now make both positive and negative sentences. Ready for questions? Let's go!
            </div>
          </div>

          <!-- STEP 3: QUESTIONS -->
          <div class="step-section" id="step3">
            <div class="step-header">
              <span class="step-number">3</span>
              <h2 class="step-title">Past Perfect Continuous - Questions</h2>
            </div>

            <div class="explanation-box">
              <h3 style="color: #1e293b; margin-top: 0;">How do we make questions?</h3>
              <p>To make questions, we start with <span class="highlight">Had</span>, then add the subject, then <span class="highlight">been</span>, then the verb + -ing.</p>
              
              <div class="formula-box">
                <div style="margin-bottom: var(--spacing-sm);">
                  <span class="formula-part verb-part">Had</span>
                  <span style="margin: 0 var(--spacing-xs);">+</span>
                  <span class="formula-part subject-part">I/you/we/they/he/she/it</span>
                  <span style="margin: 0 var(--spacing-xs);">+</span>
                  <span class="formula-part verb-part">been</span>
                  <span style="margin: 0 var(--spacing-xs);">+</span>
                  <span class="formula-part object-part">verb + -ing</span>
                  <span style="margin: 0 var(--spacing-xs);">?</span>
                </div>
                <div style="font-size: var(--font-size-sm); color: var(--color-text-muted); margin-top: var(--spacing-xs);">
                  ‚ö†Ô∏è Important: After Had, we use <strong>been</strong> and then the <strong>verb + -ing</strong> form! All subjects use "Had".
                </div>
              </div>

              <div class="example-box">
                <strong style="color: #1e293b;">Look at these examples:</strong>
                <div class="example"><span class="highlight">Had</span> you been finishing your homework when I called? (Had + you + been + finishing)</div>
                <div class="example"><span class="highlight">Had</span> she been to Paris before last year? (Had + she + been)</div>
                <div class="example"><span class="highlight">Had</span> they been seeing that movie before we watched it? (Had + they + been + seeing)</div>
                <div class="example"><span class="highlight">Had</span> he been calling you when I arrived? (Had + he + been + calling)</div>
                <div class="example"><span class="highlight">Had</span> we been studying this before the test? (Had + we + been + studying)</div>
                <div class="example"><span class="highlight">Had</span> Maria been arriving when I saw her? (Had + Maria + been + arriving)</div>
              </div>

              <div class="tip-box">
                <strong>üí° Remember:</strong> 
                <ul style="margin: var(--spacing-xs) 0; padding-left: var(--spacing-lg);">
                  <li>All subjects ‚Üí start with <strong>Had</strong></li>
                  <li>After Had, use <strong>been</strong> and then <strong>verb + -ing</strong></li>
                  <li>Don't forget the question mark <strong>?</strong></li>
                  <li>Past Perfect Continuous questions ask about actions that had been happening before a past point</li>
                </ul>
              </div>
            </div>

            <!-- Practice Exercise 5 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="help-circle" style="width: 24px; height: 24px;"></i>
                Practice: Make Questions
              </div>
              <p class="exercise-instructions">Change each statement into a question. Start with Had.</p>
              
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">1.</span>
                  <span class="fill-blank-clause">
                    <span></span>
                    <input type="text" id="ex3-1" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">she been finishing her homework when I called? (<strong>Had</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">2.</span>
                  <span class="fill-blank-clause">
                    <span></span>
                    <input type="text" id="ex3-2" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">they been to Paris before last year? (<strong>Had</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">3.</span>
                  <span class="fill-blank-clause">
                    <span></span>
                    <input type="text" id="ex3-3" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">he been seeing that movie when I asked? (<strong>Had</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">4.</span>
                  <span class="fill-blank-clause">
                    <span></span>
                    <input type="text" id="ex3-4" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">you been studying English before the test? (<strong>Had</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">5.</span>
                  <span class="fill-blank-clause">
                    <span></span>
                    <input type="text" id="ex3-5" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">Maria been working here by 2020? (<strong>Had</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">6.</span>
                  <span class="fill-blank-clause">
                    <span></span>
                    <input type="text" id="ex3-6" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">we been living here when I arrived? (<strong>Had</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">7.</span>
                  <span class="fill-blank-clause">
                    <span></span>
                    <input type="text" id="ex3-7" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">he been calling you when I saw him? (<strong>Had</strong>)</span>
                </p>
              </div>
              
              <button class="check-button" onclick="checkExercise3()">
                <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                Check My Answers
              </button>
              <div id="feedback3" class="feedback"></div>
            </div>

            <!-- Practice Exercise 6 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="refresh-cw" style="width: 24px; height: 24px;"></i>
                More Practice: Statement or Question?
              </div>
              <p class="exercise-instructions">Change each statement into a question, and each question into a statement.</p>
              
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">1.</span>
                  <span class="fill-blank-clause">
                    <span>"By last year, she had been to Paris." ‚Üí Make it a question:</span>
                    <input type="text" id="ex3b-1" class="fill-blank-input" placeholder="sentence" autocomplete="off" style="width: 100%;">
                  </span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">2.</span>
                  <span class="fill-blank-clause">
                    <span>"Had they been finishing their homework when I called?" ‚Üí Make it a statement:</span>
                    <input type="text" id="ex3b-2" class="fill-blank-input" placeholder="sentence" autocomplete="off" style="width: 100%;">
                  </span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">3.</span>
                  <span class="fill-blank-clause">
                    <span>"When I asked, he had been seeing that movie." ‚Üí Make it a question:</span>
                    <input type="text" id="ex3b-3" class="fill-blank-input" placeholder="sentence" autocomplete="off" style="width: 100%;">
                  </span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">4.</span>
                  <span class="fill-blank-clause">
                    <span>"Had you been studying English before the test?" ‚Üí Make it a statement:</span>
                    <input type="text" id="ex3b-4" class="fill-blank-input" placeholder="sentence" autocomplete="off" style="width: 100%;">
                  </span>
                </p>
              </div>
              
              <button class="check-button" onclick="checkExercise3b()">
                <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                Check My Answers
              </button>
              <div id="feedback3b" class="feedback"></div>
            </div>

            <!-- Scrambled Sentences Exercise - Questions -->
            <div class="word-scramble-section">
              <div class="exercise-title">
                <i data-lucide="shuffle" style="width: 24px; height: 24px;"></i>
                Scrambled Sentences: Put the Words in Order (Questions)
              </div>
              <p class="exercise-instructions">Put the words in the correct order to make Past Perfect Continuous questions. Remember to start with Had and end with a question mark!</p>
              
              <div class="exercise-item">
                <label>1. Put these words in order:</label>
                <div class="word-cards">
                  <span class="word-card">homework</span>
                  <span class="word-card">finishing</span>
                  <span class="word-card">been</span>
                  <span class="word-card">you</span>
                  <span class="word-card">Had</span>
                  <span class="word-card">called</span>
                  <span class="word-card">I</span>
                  <span class="word-card">when</span>
                  <span class="word-card">?</span>
                </div>
                <input type="text" class="scramble-input" id="scramble3-1" placeholder="Type the sentence here...">
                <div class="scramble-hint">Hint: Start with "Had"</div>
              </div>
              
              <div class="exercise-item">
                <label>2. Put these words in order:</label>
                <div class="word-cards">
                  <span class="word-card">Paris</span>
                  <span class="word-card">to</span>
                  <span class="word-card">been</span>
                  <span class="word-card">she</span>
                  <span class="word-card">Had</span>
                  <span class="word-card">year</span>
                  <span class="word-card">last</span>
                  <span class="word-card">before</span>
                  <span class="word-card">?</span>
                </div>
                <input type="text" class="scramble-input" id="scramble3-2" placeholder="Type the sentence here...">
                <div class="scramble-hint">Hint: Start with "Had"</div>
              </div>
              
              <div class="exercise-item">
                <label>3. Put these words in order:</label>
                <div class="word-cards">
                  <span class="word-card">movie</span>
                  <span class="word-card">that</span>
                  <span class="word-card">seeing</span>
                  <span class="word-card">been</span>
                  <span class="word-card">they</span>
                  <span class="word-card">Had</span>
                  <span class="word-card">watched</span>
                  <span class="word-card">we</span>
                  <span class="word-card">before</span>
                  <span class="word-card">?</span>
                </div>
                <input type="text" class="scramble-input" id="scramble3-3" placeholder="Type the sentence here...">
                <div class="scramble-hint">Hint: Start with "Had"</div>
              </div>
              
              <div class="exercise-item">
                <label>4. Put these words in order:</label>
                <div class="word-cards">
                  <span class="word-card">you</span>
                  <span class="word-card">calling</span>
                  <span class="word-card">been</span>
                  <span class="word-card">he</span>
                  <span class="word-card">Had</span>
                  <span class="word-card">arrived</span>
                  <span class="word-card">I</span>
                  <span class="word-card">when</span>
                  <span class="word-card">?</span>
                </div>
                <input type="text" class="scramble-input" id="scramble3-4" placeholder="Type the sentence here...">
                <div class="scramble-hint">Hint: Start with "Had"</div>
              </div>
              
              <div class="exercise-item">
                <label>5. Put these words in order:</label>
                <div class="word-cards">
                  <span class="word-card">before</span>
                  <span class="word-card">this</span>
                  <span class="word-card">studying</span>
                  <span class="word-card">been</span>
                  <span class="word-card">we</span>
                  <span class="word-card">Had</span>
                  <span class="word-card">test</span>
                  <span class="word-card">the</span>
                  <span class="word-card">?</span>
                </div>
                <input type="text" class="scramble-input" id="scramble3-5" placeholder="Type the sentence here...">
                <div class="scramble-hint">Hint: Start with "Had"</div>
              </div>
              
              <button class="check-button" onclick="checkScramble3()">
                <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                Check My Answers
              </button>
              <div id="feedback-scramble3" class="feedback"></div>
            </div>

            <div class="tip-box" style="margin-top: var(--spacing-lg);">
              <strong>‚úÖ Fantastic!</strong> You've learned positive sentences, negative sentences, and questions. Now let's put it all together!
            </div>
          </div>

          <!-- STEP 4: PUT IT ALL TOGETHER -->
          <div class="step-section" id="step4">
            <div class="step-header">
              <span class="step-number">4</span>
              <h2 class="step-title">Put It All Together - Mixed Practice</h2>
            </div>

            <div class="explanation-box">
              <h3 style="color: #1e293b; margin-top: 0;">You've learned everything! Now let's practice it all together.</h3>
              <p>In real life, you'll use positive sentences, negative sentences, and questions all mixed together. Let's practice recognizing and using all three forms!</p>
              
              <div class="formula-box" style="text-align: left; padding: var(--spacing-lg);">
                <div style="margin-bottom: var(--spacing-md);">
                  <strong style="color: #1e293b;">üìù Quick Review:</strong>
                </div>
                <div style="margin-bottom: var(--spacing-sm);">
                  <strong>Positive:</strong> I had been working. / She had been working.
                </div>
                <div style="margin-bottom: var(--spacing-sm);">
                  <strong>Negative:</strong> I hadn't been working. / She hadn't been working.
                </div>
                <div>
                  <strong>Question:</strong> Had I been working? / Had she been working?
                </div>
              </div>
            </div>

            <!-- Mixed Exercise 1 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="shuffle" style="width: 24px; height: 24px;"></i>
                Practice: Complete the Sentences (Mixed Forms)
              </div>
              <p class="exercise-instructions">Complete each sentence with the correct form. Think: Is it positive, negative, or a question?</p>
              
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">1.</span>
                  <span class="fill-blank-clause">
                    <span>When I arrived, she</span>
                    <input type="text" id="ex4-1" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">at a hospital for 5 years. (<strong>work</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">2.</span>
                  <span class="fill-blank-clause">
                    <span></span>
                    <input type="text" id="ex4-2" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">you been studying when I called? (<strong>Had</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">3.</span>
                  <span class="fill-blank-clause">
                    <span>Before they moved, they</span>
                    <input type="text" id="ex4-3" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">been living here. (<strong>hadn't</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">4.</span>
                  <span class="fill-blank-clause">
                    <span></span>
                    <input type="text" id="ex4-4" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">he been speaking English before the test? (<strong>Had</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">5.</span>
                  <span class="fill-blank-clause">
                    <span>When I saw him, he</span>
                    <input type="text" id="ex4-5" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">all night. (<strong>work</strong>)</span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">6.</span>
                  <span class="fill-blank-clause">
                    <span>Before the exam, Maria</span>
                    <input type="text" id="ex4-6" class="fill-blank-input" placeholder="verb" autocomplete="off">
                  </span>
                  <span class="fill-blank-text">every night. (<strong>study</strong>)</span>
                </p>
              </div>
              
              <button class="check-button" onclick="checkExercise4()">
                <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                Check My Answers
              </button>
              <div id="feedback4" class="feedback"></div>
            </div>

            <!-- Mixed Exercise 2 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="alert-circle" style="width: 24px; height: 24px;"></i>
                Practice: Find and Correct the Mistakes
              </div>
              <p class="exercise-instructions">Each sentence has one mistake. Find it and write the correct sentence.</p>
              
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">1.</span>
                  <span class="fill-blank-clause">
                    <span>When I arrived, she have been working here for 5 years. ‚Üí</span>
                    <input type="text" id="ex4b-1" class="fill-blank-input" placeholder="sentence" autocomplete="off" style="width: 100%;">
                  </span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">2.</span>
                  <span class="fill-blank-clause">
                    <span>Had you been finishing your homework when I called? ‚Üí</span>
                    <input type="text" id="ex4b-2" class="fill-blank-input" placeholder="sentence" autocomplete="off" style="width: 100%;">
                  </span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">3.</span>
                  <span class="fill-blank-clause">
                    <span>Before they moved, they hadn't been living here. ‚Üí</span>
                    <input type="text" id="ex4b-3" class="fill-blank-input" placeholder="sentence" autocomplete="off" style="width: 100%;">
                  </span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">4.</span>
                  <span class="fill-blank-clause">
                    <span>When I called, I had been finishing my homework. ‚Üí</span>
                    <input type="text" id="ex4b-4" class="fill-blank-input" placeholder="sentence" autocomplete="off" style="width: 100%;">
                  </span>
                </p>
              </div>
              <div class="exercise-item">
                <p class="fill-blank-sentence">
                  <span class="number">5.</span>
                  <span class="fill-blank-clause">
                    <span>Had she been arriving when I saw her? ‚Üí</span>
                    <input type="text" id="ex4b-5" class="fill-blank-input" placeholder="sentence" autocomplete="off" style="width: 100%;">
                  </span>
                </p>
              </div>
              
              <button class="check-button" onclick="checkExercise4b()">
                <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                Check My Answers
              </button>
              <div id="feedback4b" class="feedback"></div>
            </div>

            <!-- Mixed Exercise 3 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="file-text" style="width: 24px; height: 24px;"></i>
                Practice: Complete the Paragraph
              </div>
              <p class="exercise-instructions">Fill in the blanks to complete Maria's story. Use positive, negative, or question forms as needed.</p>
              
              <div style="background: var(--color-bg-light); padding: var(--spacing-lg); border-radius: var(--radius-sm); line-height: 1.8;">
                <p>
                  When I arrived at Maria's house yesterday, she <input type="text" id="ex4c-1" class="fill-blank-input" placeholder="verb" autocomplete="off" style="width: 120px;"> in Boston for 5 years. She 
                  <input type="text" id="ex4c-2" class="fill-blank-input" placeholder="verb" autocomplete="off" style="width: 120px;"> as a teacher. That morning, she 
                  <input type="text" id="ex4c-3" class="fill-blank-input" placeholder="verb" autocomplete="off" style="width: 120px;"> up at 6:00 AM. She 
                  <input type="text" id="ex4c-4" class="fill-blank-input" placeholder="verb" autocomplete="off" style="width: 120px;"> coffee, but she 
                  <input type="text" id="ex4c-5" class="fill-blank-input" placeholder="verb" autocomplete="off" style="width: 100px;"> been eating breakfast. Then she 
                  <input type="text" id="ex4c-6" class="fill-blank-input" placeholder="verb" autocomplete="off" style="width: 120px;"> to school. 
                  <input type="text" id="ex4c-7" class="fill-blank-input" placeholder="verb" autocomplete="off" style="width: 100px;"> she been enjoying her job? Yes, she 
                  <input type="text" id="ex4c-8" class="fill-blank-input" placeholder="verb" autocomplete="off" style="width: 100px;">! She 
                  <input type="text" id="ex4c-9" class="fill-blank-input" placeholder="verb" autocomplete="off" style="width: 120px;"> English!
                </p>
              </div>
              
              <button class="check-button" onclick="checkExercise4c()">
                <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
                Check My Answers
              </button>
              <div id="feedback4c" class="feedback"></div>
            </div>
          </div>

          <!-- MINI QUIZ: MEANING & USAGE -->
          <div class="step-section" id="quiz" style="background: linear-gradient(135deg, rgba(236, 72, 153, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%); border-color: #ec4899;">
            <div class="step-header">
              <span class="step-number" style="background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);">?</span>
              <h2 class="step-title">Mini Quiz: Understanding When to Use Past Perfect Continuous</h2>
            </div>

            <div class="explanation-box" style="background: white;">
              <h3 style="color: #ec4899; margin-top: 0;">Test Your Understanding!</h3>
              <p>Now let's see how well you understand <strong>when</strong> and <strong>why</strong> we use Past Perfect Continuous. This quiz tests your knowledge of the meaning and usage!</p>
            </div>

            <!-- Quiz Question 1 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="help-circle" style="width: 24px; height: 24px;"></i>
                Question 1: Which sentence uses Past Perfect Continuous correctly?
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz1" value="a" id="quiz1-a">
                  a) When I arrived, she had been living in Boston for 5 years.
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz1" value="b" id="quiz1-b">
                  b) She lived in Boston in 2019.
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz1" value="c" id="quiz1-c">
                  c) She lives in Boston now.
                </label>
              </div>
            </div>

            <!-- Quiz Question 2 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="help-circle" style="width: 24px; height: 24px;"></i>
                Question 2: Which sentence should use Past Simple?
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz2" value="a" id="quiz2-a">
                  a) When I arrived, she had been living here for 5 years.
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz2" value="b" id="quiz2-b">
                  b) She lived here in 2020.
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz2" value="c" id="quiz2-c">
                  c) By 2020, she had been living here since 2015.
                </label>
              </div>
            </div>

            <!-- Quiz Question 3 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="help-circle" style="width: 24px; height: 24px;"></i>
                Question 3: Which sentence uses Past Perfect Continuous for an action that had been happening before another past event?
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz3" value="a" id="quiz3-a">
                  a) I finished my homework yesterday.
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz3" value="b" id="quiz3-b">
                  b) When I called, she had been studying all morning.
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz3" value="c" id="quiz3-c">
                  c) I study every day.
                </label>
              </div>
            </div>

            <!-- Quiz Question 4 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="help-circle" style="width: 24px; height: 24px;"></i>
                Question 4: Which sentence uses Past Perfect Continuous for an action with duration before a past point?
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz4" value="a" id="quiz4-a">
                  a) When I arrived, she had been living here for 5 years.
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz4" value="b" id="quiz4-b">
                  b) She lived here for 5 years. (finished action)
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz4" value="c" id="quiz4-c">
                  c) She lives here now.
                </label>
              </div>
            </div>

            <!-- Quiz Question 5 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="help-circle" style="width: 24px; height: 24px;"></i>
                Question 5: Which time expression goes with Past Perfect Continuous?
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz5" value="a" id="quiz5-a">
                  a) yesterday
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz5" value="b" id="quiz5-b">
                  b) for 5 years (before a past point)
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz5" value="c" id="quiz5-c">
                  c) last week
                </label>
              </div>
            </div>

            <!-- Quiz Question 6 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="help-circle" style="width: 24px; height: 24px;"></i>
                Question 6: Which sentence uses Past Perfect Continuous correctly?
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz6" value="a" id="quiz6-a">
                  a) When I arrived, he had been working all night.
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz6" value="b" id="quiz6-b">
                  b) He worked all night yesterday. (specific time)
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz6" value="c" id="quiz6-c">
                  c) He works every night.
                </label>
              </div>
            </div>

            <!-- Quiz Question 7 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="help-circle" style="width: 24px; height: 24px;"></i>
                Question 7: Which sentence uses Past Perfect Continuous correctly?
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz7" value="a" id="quiz7-a">
                  a) When I called, she had been studying for 2 hours.
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz7" value="b" id="quiz7-b">
                  b) When I called, she hadn't been studying yet.
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz7" value="c" id="quiz7-c">
                  c) She studied for 2 hours yesterday.
                </label>
              </div>
            </div>

            <!-- Quiz Question 8 -->
            <div class="exercise-section">
              <div class="exercise-title">
                <i data-lucide="help-circle" style="width: 24px; height: 24px;"></i>
                Question 8: When should you use Past Simple instead of Past Perfect Continuous?
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz8" value="a" id="quiz8-a">
                  a) When there's a specific past time mentioned (yesterday, last week, in 2019)
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz8" value="b" id="quiz8-b">
                  b) When talking about actions that had been happening before another past event
                </label>
              </div>
              <div class="exercise-item">
                <label>
                  <input type="radio" name="quiz8" value="c" id="quiz8-c">
                  c) When emphasizing duration before a past point
                </label>
              </div>
            </div>

            <button class="check-button" onclick="checkQuiz()" style="margin-top: var(--spacing-lg);">
              <i data-lucide="check-circle" style="width: 20px; height: 20px;"></i>
              Check My Quiz Answers
            </button>
            <div id="feedback-quiz" class="feedback"></div>

            <div class="tip-box" style="margin-top: var(--spacing-lg);">
                <strong>üí° Remember:</strong> Past Perfect Continuous shows actions that had been happening <strong>before a point in the past</strong>. Use Past Simple for actions at a <strong>specific past time</strong> (yesterday, last week, in 2019, etc.)!
            </div>
          </div>

          <!-- Summary Box -->
          <div class="explanation-box" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%); border-color: rgba(16, 185, 129, 0.3);">
              <h3 style="color: #10b981; margin-top: 0;">
              <i data-lucide="award" style="width: 20px; height: 20px; display: inline-block; vertical-align: middle;"></i>
              Congratulations! You've Completed Past Perfect Continuous!
              </h3>
              <p><strong>You now know how to:</strong></p>
              <ul style="margin: var(--spacing-sm) 0; padding-left: var(--spacing-lg);">
                <li>‚úÖ Make positive sentences (I had been working / She had been working)</li>
                <li>‚úÖ Make negative sentences (I hadn't been working / She hadn't been working)</li>
                <li>‚úÖ Make questions (Had I been working? / Had she been working?)</li>
                <li>‚úÖ Use verb + -ing (regular and irregular verbs)</li>
                <li>‚úÖ Use For/Since correctly with past contexts</li>
                <li>‚úÖ Choose between Past Perfect Simple and Past Perfect Continuous</li>
                <li>‚úÖ Use Past Perfect Continuous in real situations</li>
              </ul>
              <p style="margin-top: var(--spacing-md);"><strong>Keep practicing!</strong> The more you use Past Perfect Continuous, the easier it becomes.</p>
            </div>
          </div>

        </div>
      </div>
    </section>
  </main>

  <footer style="background-color: var(--color-bg-gray); padding: var(--spacing-xl) 0; margin-top: var(--spacing-3xl);">
    <div class="container text-center">
      <p style="color: var(--color-text-muted); font-size: var(--font-size-sm);">
        ESOL Teacher Resources - Free materials for English language educators
      </p>
    </div>
  </footer>

  <script src="../../../assets/js/main.js"></script>
  <script>
    // Initialize Lucide icons
    if (typeof lucide !== 'undefined') {
      lucide.createIcons();
    }

    // Answer keys
    const answers = {
      ex1: ['had been working', 'had been living', 'had been seeing', 'had been finishing', 'had been'],
      ex1b: ['had been working', 'had been living', 'had been seeing', 'had been finishing'],
      ex2: ["hadn't been finishing", "hadn't been", "hadn't been seeing", "hadn't been calling", "hadn't been studying", "hadn't been arriving"],
      ex2b: ['had been working', 'had been living', 'had been seeing', 'had been finishing'],
      ex3: ['Had', 'Had', 'Had', 'Had', 'Had', 'Had', 'Had'],
      ex3b: ['Had she been to Paris before last year?', 'When I called, they had been finishing their homework.', 'Had he been seeing that movie when I asked?', 'Before the test, you had been studying English.'],
      ex4: ['had been working', 'Had', "hadn't", 'Had', 'had been working', 'had been studying'],
      ex4b: [
        'When I arrived, she had been working here for 5 years.',
        'Had you been finishing your homework when I called?',
        "Before they moved, they hadn't been living here.",
        'When I called, I had been finishing my homework.',
        'Had she been arriving when I saw her?'
      ],
      ex4c: ['had been living', 'had been working', 'had been waking', 'had been drinking', "hadn't", 'had been going', 'Had', 'had', 'had been teaching'],
      meaning: ['duration', 'recent', 'temporary', 'visible', 'repeated'],
      timeExpressions: [
        'for',
        'since',
        'for'
      ],
      scramble1: [
        'When I arrived, she had been working here for 5 years.',
        'When I called, I had been finishing my homework.',
        'By 2020, Maria had been to Paris twice.',
        'Before they moved, we had been studying English for 2 years.',
        'When I asked, they had been seeing that movie.'
      ],
      scramble2: [
        "When I called, I hadn't been finishing my homework yet.",
        "By last year, she hadn't been to Paris.",
        "When I asked, they hadn't been seeing that movie.",
        "When I arrived, he hadn't been calling me.",
        "Before they moved, we hadn't been studying Spanish."
      ],
      scramble3: [
        'Had you been finishing your homework when I called?',
        'Had she been to Paris before last year?',
        'Had they been seeing that movie before we watched it?',
        'Had he been calling you when I arrived?',
        'Had we been studying this before the test?'
      ],
      quiz: ['a', 'b', 'b', 'a', 'b', 'a', 'a', 'a']
    };

    function updateProgress(step) {
      for (let i = 1; i <= 4; i++) {
        const dot = document.getElementById(`dot${i}`);
        if (i < step) {
          dot.className = 'progress-dot completed';
        } else if (i === step) {
          dot.className = 'progress-dot active';
        } else {
          dot.className = 'progress-dot';
        }
      }
    }

    function checkExercise1() {
      const feedback = document.getElementById('feedback1');
      let correct = 0;
      let total = 5;
      
      answers.ex1.forEach((answer, index) => {
        const input = document.getElementById(`ex1-${index + 1}`);
        if (!input) return;
        if (input.value.toLowerCase().trim() === answer.toLowerCase()) {
          correct++;
          input.style.borderColor = '#10b981';
          input.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        } else {
          input.style.borderColor = '#ef4444';
          input.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = correct === total 
        ? `‚úÖ Perfect! You got all ${total} correct! Great job with positive sentences. Ready for the next step?`
        : `You got ${correct} out of ${total} correct. Remember: All subjects use "had"! Keep practicing!`;
      feedback.style.display = 'block';
      
      if (correct === total) {
        updateProgress(2);
      }
    }

    function checkExercise1b() {
      const feedback = document.getElementById('feedback1b');
      let correct = 0;
      let total = 4;
      
      answers.ex1b.forEach((answer, index) => {
        const select = document.getElementById(`ex1b-${index + 1}`);
        if (!select) return;
        if (select.value === answer) {
          correct++;
          select.style.borderColor = '#10b981';
          select.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        } else {
          select.style.borderColor = '#ef4444';
          select.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = correct === total 
        ? `‚úÖ Excellent! You got all ${total} correct!`
        : `You got ${correct} out of ${total} correct. Keep practicing!`;
      feedback.style.display = 'block';
    }

    function checkExercise2() {
      const feedback = document.getElementById('feedback2');
      let correct = 0;
      let total = 6;
      
      answers.ex2.forEach((answer, index) => {
        const input = document.getElementById(`ex2-${index + 1}`);
        if (!input) return;
        if (input.value.toLowerCase().trim() === answer.toLowerCase()) {
          correct++;
          input.style.borderColor = '#10b981';
          input.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        } else {
          input.style.borderColor = '#ef4444';
          input.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = correct === total 
        ? `‚úÖ Perfect! You got all ${total} correct! Great job with negative sentences. Ready for questions?`
        : `You got ${correct} out of ${total} correct. Remember: All subjects use "hadn't"!`;
      feedback.style.display = 'block';
      
      if (correct === total) {
        updateProgress(3);
      }
    }

    function checkExercise2b() {
      const feedback = document.getElementById('feedback2b');
      let correct = 0;
      let total = 4;
      
      answers.ex2b.forEach((answer, index) => {
        const input = document.getElementById(`ex2b-${index + 1}`);
        if (!input) return;
        if (input.value.toLowerCase().trim() === answer.toLowerCase()) {
          correct++;
          input.style.borderColor = '#10b981';
          input.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        } else {
          input.style.borderColor = '#ef4444';
          input.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = correct === total 
        ? `‚úÖ Excellent! You got all ${total} correct!`
        : `You got ${correct} out of ${total} correct. Keep practicing!`;
      feedback.style.display = 'block';
    }

    function checkExercise3() {
      const feedback = document.getElementById('feedback3');
      let correct = 0;
      let total = 7;
      
      answers.ex3.forEach((answer, index) => {
        const input = document.getElementById(`ex3-${index + 1}`);
        if (!input) return;
        if (input.value.trim() === answer) {
          correct++;
          input.style.borderColor = '#10b981';
          input.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        } else {
          input.style.borderColor = '#ef4444';
          input.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = correct === total 
        ? `‚úÖ Perfect! You got all ${total} correct! Great job with questions. Ready to put it all together?`
        : `You got ${correct} out of ${total} correct. Remember: All subjects use "Had"!`;
      feedback.style.display = 'block';
      
      if (correct === total) {
        updateProgress(4);
      }
    }

    function checkExercise3b() {
      const feedback = document.getElementById('feedback3b');
      let correct = 0;
      let total = 4;
      
      answers.ex3b.forEach((answer, index) => {
        const input = document.getElementById(`ex3b-${index + 1}`);
        if (!input) return;
        const userAnswer = input.value.trim();
        if (userAnswer.toLowerCase().replace(/[.,!?]/g, '').includes(answer.toLowerCase().replace(/[.,!?]/g, '').substring(0, 10))) {
          correct++;
          input.style.borderColor = '#10b981';
          input.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        } else {
          input.style.borderColor = '#ef4444';
          input.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = correct === total 
        ? `‚úÖ Excellent! You got all ${total} correct!`
        : `You got ${correct} out of ${total} correct. Keep practicing!`;
      feedback.style.display = 'block';
    }

    function checkExercise4() {
      const feedback = document.getElementById('feedback4');
      let correct = 0;
      let total = 6;
      
      answers.ex4.forEach((answer, index) => {
        const input = document.getElementById(`ex4-${index + 1}`);
        if (!input) return;
        if (input.value.toLowerCase().trim() === answer.toLowerCase()) {
          correct++;
          input.style.borderColor = '#10b981';
          input.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        } else {
          input.style.borderColor = '#ef4444';
          input.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = correct === total 
        ? `‚úÖ Perfect! You got all ${total} correct! You're mastering Past Perfect Continuous!`
        : `You got ${correct} out of ${total} correct. Think about whether it's positive, negative, or a question!`;
      feedback.style.display = 'block';
    }

    function checkExercise4b() {
      const feedback = document.getElementById('feedback4b');
      let correct = 0;
      let total = 5;
      
      answers.ex4b.forEach((answer, index) => {
        const input = document.getElementById(`ex4b-${index + 1}`);
        if (!input) return;
        const userAnswer = input.value.trim();
        if (userAnswer.toLowerCase().replace(/[.,!?]/g, '').includes(answer.toLowerCase().replace(/[.,!?]/g, '').substring(0, 15))) {
          correct++;
          input.style.borderColor = '#10b981';
          input.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        } else {
          input.style.borderColor = '#ef4444';
          input.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = correct === total 
        ? `‚úÖ Excellent! You found all ${total} mistakes!`
        : `You got ${correct} out of ${total} correct. Look carefully at the verb forms!`;
      feedback.style.display = 'block';
    }

    function checkExercise4c() {
      const feedback = document.getElementById('feedback4c');
      let correct = 0;
      let total = 9;
      
      answers.ex4c.forEach((answer, index) => {
        const input = document.getElementById(`ex4c-${index + 1}`);
        if (!input) return;
        if (input.value.toLowerCase().trim() === answer.toLowerCase()) {
          correct++;
          input.style.borderColor = '#10b981';
          input.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        } else {
          input.style.borderColor = '#ef4444';
          input.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = correct === total 
        ? `‚úÖ Perfect! You got all ${total} correct! You've mastered Past Perfect Continuous! üéâ`
        : `You got ${correct} out of ${total} correct. Great effort! Keep practicing!`;
      feedback.style.display = 'block';
    }

    function checkMeaningExercise() {
      const feedback = document.getElementById('feedback-meaning');
      let correct = 0;
      let total = 5;
      
      answers.meaning.forEach((answer, index) => {
        const select = document.getElementById(`meaning-${index + 1}`);
        if (!select) return;
        if (select.value === answer) {
          correct++;
          select.style.borderColor = '#10b981';
          select.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        } else {
          select.style.borderColor = '#ef4444';
          select.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = correct === total 
        ? `‚úÖ Perfect! You got all ${total} correct! You understand when to use Past Perfect Continuous!`
        : `You got ${correct} out of ${total} correct. Think about: ongoing actions with duration before a past point, actions that had been happening before another past event, temporary situations before a past point, repeated actions over time before a past point, and actions with visible results at a past point!`;
      feedback.style.display = 'block';
    }

    function checkTimeExpressions() {
      const feedback = document.getElementById('feedback-time');
      let correct = 0;
      let total = 3;
      const expectedAnswers = [
        ['for'],
        ['since'],
        ['just', 'already']
      ];
      
      expectedAnswers.forEach((possibleAnswers, index) => {
        const input = document.getElementById(`time-ex${index + 1}`);
        if (!input) return;
        const userAnswer = normalizeAnswer(input.value);
        let isCorrect = false;
        
        possibleAnswers.forEach(answer => {
          if (userAnswer.includes(answer)) {
            isCorrect = true;
          }
        });
        
        if (isCorrect) {
          correct++;
          input.style.borderColor = '#10b981';
          input.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        } else {
          input.style.borderColor = '#ef4444';
          input.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = correct === total 
        ? `‚úÖ Perfect! You got all ${total} correct! You can identify time expressions for Past Perfect Continuous!`
        : `You got ${correct} out of ${total} correct. Remember: Look for words like "for", "since", "when", "before", "by the time", etc.`;
      feedback.style.display = 'block';
    }

    function checkStateVerbs() {
      const feedback = document.getElementById('feedback-state-verbs');
      let correct = 0;
      let total = 5;
      const answers = ['state', 'action', 'state', 'action', 'state'];
      const explanations = [
        '‚úÖ Correct! "Like" is a state verb (feeling) - we say "I like" not "I am liking".',
        '‚úÖ Correct! "Eating" is an action verb (activity) - action verbs can use continuous forms.',
        '‚úÖ Correct! "Know" is a state verb (thought) - we say "I know" not "I am knowing".',
        '‚úÖ Correct! "Studying" is an action verb (activity) - action verbs can use continuous forms.',
        '‚úÖ Correct! "Want" is a state verb (desire) - we say "I want" not "I am wanting".'
      ];
      
      answers.forEach((answer, index) => {
        const select = document.getElementById(`state-verb-${index + 1}`);
        if (!select) return;
        if (select.value === answer) {
          correct++;
          select.style.borderColor = '#10b981';
          select.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        } else if (select.value) {
          select.style.borderColor = '#ef4444';
          select.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      
      let feedbackHTML = '';
      if (correct === total) {
        feedbackHTML = `‚úÖ Perfect! You got all ${total} correct! You understand the difference between state verbs and action verbs!`;
      } else {
        feedbackHTML = `<strong>You got ${correct} out of ${total} correct.</strong><br><br>`;
        feedbackHTML += '<strong>Review your answers:</strong><br>';
        
        answers.forEach((answer, index) => {
          const select = document.getElementById(`state-verb-${index + 1}`);
          if (!select || !select.value || select.value !== answer) {
            feedbackHTML += `<br><strong>Question ${index + 1}:</strong> ${explanations[index]}`;
          }
        });
      }
      
      feedback.innerHTML = feedbackHTML;
      feedback.style.display = 'block';
    }

    function normalizeAnswer(answer) {
      // Remove extra spaces, normalize punctuation, convert to lowercase
      return answer.toLowerCase().trim().replace(/\s+/g, ' ').replace(/[.,!?]/g, '');
    }

    function checkScramble1() {
      const feedback = document.getElementById('feedback-scramble1');
      let correct = 0;
      let total = 5;
      
      answers.scramble1.forEach((answer, index) => {
        const input = document.getElementById(`scramble1-${index + 1}`);
        if (!input) return;
        const userAnswer = normalizeAnswer(input.value);
        const correctAnswer = normalizeAnswer(answer);
        
        if (userAnswer === correctAnswer) {
          correct++;
          input.style.borderColor = '#10b981';
          input.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        } else {
          input.style.borderColor = '#ef4444';
          input.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = correct === total 
        ? `‚úÖ Perfect! You got all ${total} correct! Great job putting positive sentences in order!`
        : `You got ${correct} out of ${total} correct. Remember: Subject + had + been + verb + -ing. Keep practicing!`;
      feedback.style.display = 'block';
    }

    function checkScramble2() {
      const feedback = document.getElementById('feedback-scramble2');
      let correct = 0;
      let total = 5;
      
      answers.scramble2.forEach((answer, index) => {
        const input = document.getElementById(`scramble2-${index + 1}`);
        if (!input) return;
        const userAnswer = normalizeAnswer(input.value);
        const correctAnswer = normalizeAnswer(answer);
        
        if (userAnswer === correctAnswer) {
          correct++;
          input.style.borderColor = '#10b981';
          input.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        } else {
          input.style.borderColor = '#ef4444';
          input.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = correct === total 
        ? `‚úÖ Perfect! You got all ${total} correct! Great job putting negative sentences in order!`
        : `You got ${correct} out of ${total} correct. Remember: Subject + hadn't + been + verb + -ing. Keep practicing!`;
      feedback.style.display = 'block';
    }

    function checkScramble3() {
      const feedback = document.getElementById('feedback-scramble3');
      let correct = 0;
      let total = 5;
      
      answers.scramble3.forEach((answer, index) => {
        const input = document.getElementById(`scramble3-${index + 1}`);
        if (!input) return;
        const userAnswer = normalizeAnswer(input.value);
        const correctAnswer = normalizeAnswer(answer);
        
        if (userAnswer === correctAnswer) {
          correct++;
          input.style.borderColor = '#10b981';
          input.style.backgroundColor = 'rgba(16, 185, 129, 0.1)';
        } else {
          input.style.borderColor = '#ef4444';
          input.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = correct === total 
        ? `‚úÖ Perfect! You got all ${total} correct! Great job putting questions in order!`
        : `You got ${correct} out of ${total} correct. Remember: Had + subject + been + verb + -ing + ? Keep practicing!`;
      feedback.style.display = 'block';
    }

    function checkQuiz() {
      const feedback = document.getElementById('feedback-quiz');
      let correct = 0;
      let total = 8;
      const explanations = [
        { correct: 'a', explanation: '‚úÖ Correct! "When I arrived, she had been living in Boston for 5 years" uses Past Perfect Continuous correctly - action that had been happening before I arrived.' },
        { correct: 'b', explanation: '‚úÖ Correct! "She lived here in 2020" uses Past Simple because there\'s a specific past time (2020).' },
        { correct: 'b', explanation: '‚úÖ Correct! "When I called, she had been studying all morning" uses Past Perfect Continuous for an action that had been happening before I called.' },
        { correct: 'a', explanation: '‚úÖ Correct! "When I arrived, she had been living here for 5 years" uses Past Perfect Continuous for an action with duration before a past point.' },
        { correct: 'b', explanation: '‚úÖ Correct! "for 5 years" is used with Past Perfect Continuous to show duration before a past point.' },
        { correct: 'a', explanation: '‚úÖ Correct! "When I arrived, he had been working all night" uses Past Perfect Continuous correctly - action that had been happening before I arrived.' },
        { correct: 'a', explanation: '‚úÖ Correct! "When I called, she had been studying for 2 hours" uses Past Perfect Continuous correctly - action that had been happening before I called.' },
        { correct: 'a', explanation: '‚úÖ Correct! Use Past Simple when there\'s a specific past time mentioned (yesterday, last week, in 2019).' }
      ];
      
      answers.quiz.forEach((answer, index) => {
        const questionNum = index + 1;
        const selected = document.querySelector(`input[name="quiz${questionNum}"]:checked`);
        
        if (selected && selected.value === answer) {
          correct++;
          // Highlight correct answer
          const label = selected.closest('label');
          if (label) {
            label.style.color = '#10b981';
            label.style.fontWeight = '600';
          }
        } else {
          // Highlight incorrect answer
          if (selected) {
            const label = selected.closest('label');
            if (label) {
              label.style.color = '#ef4444';
            }
          }
          // Show correct answer
          const correctRadio = document.getElementById(`quiz${questionNum}-${answer}`);
          if (correctRadio) {
            const correctLabel = correctRadio.closest('label');
            if (correctLabel) {
              correctLabel.style.color = '#10b981';
              correctLabel.style.fontWeight = '600';
            }
          }
        }
      });
      
      feedback.className = `feedback ${correct === total ? 'correct' : 'incorrect'}`;
      
      let feedbackHTML = '';
      if (correct === total) {
        feedbackHTML = `üéâ <strong>Perfect Score!</strong> You got all ${total} questions correct! You really understand when to use Past Perfect Continuous!`;
      } else {
        feedbackHTML = `<strong>You got ${correct} out of ${total} correct.</strong><br><br>`;
        feedbackHTML += '<strong>Review your answers:</strong><br>';
        
        answers.quiz.forEach((answer, index) => {
          const questionNum = index + 1;
          const selected = document.querySelector(`input[name="quiz${questionNum}"]:checked`);
          if (!selected || selected.value !== answer) {
            feedbackHTML += `<br><strong>Question ${questionNum}:</strong> ${explanations[index].explanation}`;
          }
        });
      }
      
      feedback.innerHTML = feedbackHTML;
      feedback.style.display = 'block';
    }

    // Initialize progress
    updateProgress(1);
  </script>
</body>
</html>
